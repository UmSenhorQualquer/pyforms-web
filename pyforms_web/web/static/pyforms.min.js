var COLUMNS_CSS_CLASSES=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fiveteen","sixteen","seventeen","eighteen","nineteen","twenty","twentyone","twentytwo"];class ControlBase{constructor(e,t){this.name=e,this.properties=t,this.basewidget=void 0,this.added_classes=[],this.added_fieldclasses=[]}app_id(){return this.basewidget.widget_id}control_id(){return this.basewidget.control_id(this.name)}jquery(){return $("#"+this.control_id())}place_id(){return"place-"+this.control_id()}jquery_place(){return $("#"+this.place_id())}set_css(e){for(var t=0;t<this.added_classes.length;t++)this.jquery().removeClass(this.added_classes[t]);if(void 0!==e&&0!=e.length){for(var i=e.split(" "),t=0;t<i.length;t++)this.jquery().addClass(i[t]);this.added_classes=i}}set_field_css(e){for(var t=0;t<this.added_fieldclasses.length;t++)this.jquery_place().removeClass(this.added_fieldclasses[t]);for(var i=e.split(" "),t=0;t<i.length;t++)this.jquery_place().addClass(i[t]);this.added_fieldclasses=i}init_help(){var e=this.properties.help;e&&e.trim().length&&(e=`<i class="help circle icon" style="float: right" title="${e}" style="margin: -0.2em 0em 0em 0.2em;"></i>`,$(`#${this.place_id()} label[for='${this.control_id()}']`).first().before(e))}get_value(){var e;return 0==this.jquery().length?this.properties.value:"null"==(e=this.jquery().val())?null:e}set_inline(){this.jquery_place().addClass("inline")}set_value(e){0<this.jquery().length&&(null!=e?this.jquery().val(e):this.jquery().val(""))}set_label(e){$(`#${this.place_id()} label[for='${this.control_id()}']`).first().html(e)}set_required(){this.jquery_place().addClass("required")}enable(){this.jquery().removeAttr("disabled"),this.jquery().removeClass("disabled")}disable(){this.jquery().attr("disabled","true"),this.jquery().addClass("disabled")}hide(){function e(e){var i=0;return e.each(function(e,t){"none"!=$(t).css("display")&&(i+=1)}),i}if(0!=e(this.jquery_place())){this.jquery_place().hide(),this.properties.visible=!1;var t=this.jquery_place().parent();if(t.hasClass("row")&&t.hasClass("fields")){if(!t.hasClass("no-alignment"))for(var i=COLUMNS_CSS_CLASSES.length;1<i;i--)if(t.hasClass(COLUMNS_CSS_CLASSES[i])){t.removeClass(COLUMNS_CSS_CLASSES[i]),t.addClass(COLUMNS_CSS_CLASSES[i-1]);break}if(0==e(t.find(".control"))){t.hide();for(i=0;i<COLUMNS_CSS_CLASSES.length-1;i++)t.removeClass(COLUMNS_CSS_CLASSES[i])}}var s=this.jquery_place().parents(".pyforms-segment");0==e(s.find(".control"))&&s.hide()}}show(){if(!this.jquery_place().is(":visible")){this.jquery_place().show(),this.properties.visible=!0;var e=this.jquery_place().parent();if(e.hasClass("row"))if(e.hasClass("no-alignment"))e.show();else{e.hasClass("fields")&&e.show();for(var t=!1,i=1;i<COLUMNS_CSS_CLASSES.length-1;i++)if(e.hasClass(COLUMNS_CSS_CLASSES[i])){e.removeClass(COLUMNS_CSS_CLASSES[i]),e.addClass(COLUMNS_CSS_CLASSES[i+1]),t=!0;break}t||(e.addClass("fields"),e.addClass("one"))}var s=this.jquery_place().parents(".pyforms-segment");s&&s.show()}}deserialize(e){var t=e.value!=this.properties.value;$.extend(this.properties,e),t&&this.set_value(this.properties.value),this.set_label(this.properties.label),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}apply_deserialization(e){this.properties.visible?this.show():this.hide(),this.properties.enabled?this.enable():this.disable(),this.properties.style&&this.jquery().attr("style",this.properties.style),this.properties.field_style&&this.jquery_place().attr("style",this.properties.field_style),this.properties.css&&this.set_css(this.properties.css),this.properties.field_css&&this.set_field_css(this.properties.field_css)}serialize(){return this.properties.value=this.get_value(),this.properties}init_control(){this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}after_init_control(){this.properties.enabled||this.disable(),this.properties.style&&this.jquery().attr("style",this.properties.style),this.properties.field_style&&this.jquery_place().attr("style",this.properties.field_style),this.properties.css&&this.set_css(this.properties.css),this.properties.field_css&&this.set_field_css(this.properties.field_css),this.properties.help&&this.init_help(),this.properties.visible||this.hide(),this.properties.inline&&this.set_inline()}update_server(){return this.get_value()!=this.properties.value}}class BaseControlStreaming extends ControlBase{xmlhttp=void 0;stream_end(){super.stream_end()}stream_update(e){this.set_value(e.target.responseText)}deserialize(e){super.deserialize(e),!0===this.properties.abort_streaming&&(this.xmlhttp&&this.xmlhttp.abort(),this.xmlhttp=void 0),!0===this.properties.start_streaming&&(this.xmlhttp=new XMLHttpRequest,this.xmlhttp.addEventListener("load",this.stream_end),this.xmlhttp.addEventListener("progress",e=>this.stream_update(e),!1),this.xmlhttp.open("get",`/pyforms/field-stream/${this.app_id()}/${this.name}/`,!0),this.xmlhttp.send())}}class BaseWidget{constructor(e,t,i,s,r){this.name=t,this.widget_id=e,this.controls=i,this.events_queue=[],this.parent_id=s,this.layout_position=r.layout_position,this.timeouts_loops=[],this.xmlhttp=void 0,this.stream_length=0,this.keydown_codes=r.keydown_codes,this.keydown_keycode=void 0,this.loading_begin=void 0;for(var o=this.loading_counter=0;o<i.length;o++){var a=i[o];a.basewidget=this,a.init_control()}for(var l,o=0;o<i.length;o++)i[o].after_init_control();if(null!=r.messages)for(var n=0;n<r.messages.length;n++){var h=r.messages[n],d=(""!=h.type&&this.jquery().addClass(h.type),'<div class="ui '+h.type+' message">');if(d+='<i class="close icon"></i>',h.title&&(d+='<div class="header">'+h.title+"</div>"),1==h.messages.length)d+="<p>"+h.messages[0]+"</p>";else{d+='<ul class="list">';for(n=0;n<h.messages.length;n++)d+="<li>"+h.messages[n]+"</li>";d+="</ul>"}$(d).prependTo(this.jquery()).find(".close").on("click",function(){$(this).closest(".message").transition({animation:"fade",onComplete:function(){$(this).remove()}})})}r.refresh_timeout&&((l=this).refresh_timeout=r.refresh_timeout,this.timeout_loop=setInterval(function(){l.refresh_timeout_event()},r.refresh_timeout)),$("#"+this.app_id()).click(()=>{pyforms.active_app=this})}key_pressed(e){this.keydown_codes&&-1!==this.keydown_codes.indexOf(e.keyCode)&&(this.keydown_keycode=e.keyCode,this.fire_event("self","keydown_event"))}refresh_timeout_event(){this.fire_event("self","refresh_event")}parent_widget(){return void 0!==this.parent_id?pyforms.find_app(this.parent_id):void 0}find_control(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t].name==e)return this.controls[t]}app_id(e){return"app-"+this.widget_id}control_id(e){return this.widget_id+"-"+e}fire_event(e,t,i){this.events_queue.push({event:{control:e,event:t}}),void 0===this.parent_id?pyforms.query_server(this,this.events_queue.pop(0),i):pyforms.query_server(this,void 0,i)}update_controls(){pyforms.query_server(this,{})}deserialize(data){var js_code2excute=data["js-code"];if(js_code2excute&&0<js_code2excute.length)for(var i=0;i<js_code2excute.length;i++)eval(js_code2excute[i]);for(var index=0,self;index<this.controls.length;index++){var control=this.controls[index];data[control.name]&&(control.deserialize(data[control.name]),control.apply_deserialization())}if(null!=data.messages)for(var i=0;i<data.messages.length;i++){var msg=data.messages[i],html=(""!=msg.type&&this.jquery().addClass(msg.type),'<div class="ui '+msg.type+' message">');if(html+='<i class="close icon"></i>',msg.title&&(html+='<div class="header">'+msg.title+"</div>"),1==msg.messages.length)html+="<p>"+msg.messages[0]+"</p>";else{html+='<ul class="list">';for(var i=0;i<msg.messages.length;i++)html+="<li>"+msg.messages[i]+"</li>";html+="</ul>"}var destination=this.jquery().find(".notifications-area");0==destination.length&&(destination=this.jquery()),$(html).prependTo(destination).find(".close").on("click",function(){$(this).closest(".message").transition({animation:"fade",onComplete:function(){$(this).remove()}})})}data.close_widget&&(pyforms.close_layout_place(data),pyforms.remove_app(data.uid)),null!=data.refresh_timeout?this.refresh_timeout!=data.refresh_timeout&&(self=this,this.timeout_loop&&clearInterval(this.timeout_loop),this.refresh_timeout=data.refresh_timeout,this.timeout_loop=setInterval(function(){self.refresh_timeout_event()},data.refresh_timeout)):this.timeout_loop&&(clearInterval(this.timeout_loop),this.timeout_loop=null);var timeouts=data.timeouts;if(0<timeouts.length)for(var i=0;i<timeouts.length;i++){var self=this,milliseconds=timeouts[i][0],evt_name=timeouts[i][1];this.timeouts_loops.push(setTimeout(function(){self.fire_event("self",evt_name)},milliseconds))}if(data.abort_streaming&&(this.xmlhttp&&(this.xmlhttp.abort(),this.stream_length=0),this.xmlhttp=void 0),data.start_streaming){const source=new EventSource(`/pyforms/app-stream/${this.widget_id}/`);source.onmessage=e=>{"STOP"===e.data?source.close():this.stream_update(e)}}}stream_end(){this.stream_length=0}stream_update(e){this.deserialize(JSON.parse(e.data))}serialize(){for(var e=void 0,e=0<this.events_queue.length?this.events_queue.pop(0):{},t=0;t<this.controls.length;t++)e[this.controls[t].name]=this.controls[t].serialize();return e}serialize_data(e){for(var t=0;t<this.controls.length;t++){var i=this.controls[t];i.update_server()&&(e[i.name]=i.serialize())}return e.uid=this.widget_id,e.keydown_keycode=this.keydown_keycode,e}activate_load_event(){return this.loading_counter<=0?(this.jquery().removeClass("loading"),!1):(null!=this.loading_begin&&Date.now()-this.loading_begin>PYFORMS_CHECKER_LOOP_INTERVAL&&!this.jquery().hasClass("loading")&&this.jquery().addClass("loading"),!0)}loading(){var e;null==this.loading_begin&&(this.loading_begin=Date.now()),this.loading_counter++,1==this.loading_counter&&(e=this,pyforms.register_checkloop(function(){return e.activate_load_event()}))}not_loading(){this.loading_counter--,pyforms.checker_loop()}close_sub_apps(){for(var e=0;e<this.controls.length;e++)void 0!==this.controls[e].properties.child_widget_id&&pyforms.remove_app(this.controls[e].properties.child_widget_id)}query_server(e){pyforms.query_server(this,e)}jquery(){return $("#app-"+this.widget_id)}close(){clearTimeout(this.timeout_loop);for(var e=0;e<this.timeouts_loops.length;e++)clearTimeout(this.timeouts_loops[e]);this.close_sub_apps(),this.jquery().remove()}}class ControlAutoComplete extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlAutoComplete' >",t=(this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e=(e=e+("<div class='ui search dropdown "+(this.properties.multiple?"multiple":"")+" selection' id='"+this.control_id()+"' >")+'<i class="ui search small icon"></i>')+`<div class="default text">${this.properties.placeholder}</div>`+"</div>",this.jquery_place().replaceWith(e),this.jquery().dropdown({apiSettings:{url:this.properties.items_url,cache:!1},saveRemoteData:!1,placeholder:this.properties.placeholder,forceSelection:!1}),this.jquery().dropdown("setup menu",{values:this.properties.items}),this.set_value(this.properties.value),this);this.jquery().dropdown("setting","onChange",function(){t.flag_exec_on_change_event&&t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}set_value(e){this.flag_exec_on_change_event=!1,this.properties.multiple||(e=[e]),this.jquery().dropdown("set exactly",e),this.flag_exec_on_change_event=!0}get_value(){var e=this.jquery().dropdown("get value");return this.properties.multiple?0==e.length||""==e?[]:e.split(","):0==e.length||""==e?null:e}deserialize(e){this.properties=$.extend(this.properties,e),this.jquery().dropdown("setup menu",{values:this.properties.items}),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}update_server(){var e=this.properties.value,t=this.get_value();if(this.properties.multiple){if(e.sort(),t.sort(),t.length!=e.length)return!0;for(var i=0;i<t.length;i++)if(t[i]!=e[i]+"")return!0;return!1}return t!=e}}class ControlBarsChart extends ControlBase{init_control(){this.update_it=!1;var e="<div id='"+this.place_id()+"' class='field control ControlBarsChart' >",e=(e+="<div id='chart-container-"+this.control_id()+"' title='"+this.properties.help+"'   >")+"<div id='"+this.control_id()+"' ></div></div></div>";this.jquery_place().replaceWith(e);var e=(r=this).properties.legend,t=r.properties.value,t=(0!=t.length&&0!=t[0].length||(t=[[[0,0]]]),$.jqplot(this.control_id(),t,{seriesColors:["#f2711c","#fbbd08","#b5cc18","#21ba45","#00b5ad","#2185d0","#6435c9","#a333c8","#e03997","#a5673f","#767676","#1b1c1d","#DB2828"],grid:{borderColor:"transparent",shadow:!1,drawBorder:!1,shadowColor:"transparent",background:"transparent"},title:r.label,seriesDefaults:{renderer:$.jqplot.BarRenderer,pointLabels:{show:!0}},legend:{show:0<e.length,labels:e,placement:"inside",location:"e"},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:e}},cursor:{style:"pointer",show:!0,zoom:!0,tooltipOffset:10,showTooltip:!0,followMouse:!0,showTooltipDataPosition:!0,showVerticalLine:!0}})),r=(this.chart=t,this);this.jquery().bind("jqplotDataClick",function(e,t,i,s){r.properties.selected_series=t,r.properties.selected_data=s,r.update_it=!0,r.basewidget.fire_event(r.name,"remote_data_selected_event")}),this.properties.required&&this.set_required()}set_value(e){e={data:e,legend:{show:0<this.properties.legend.length,labels:this.properties.legend,showLabels:!0,showSwatch:!0}};this.chart.replot(e)}get_value(){return this.properties.value}update_server(){return this.get_value()!=this.properties.value||this.update_it}deserialize(e){this.properties=$.extend(this.properties,e),this.set_value(this.properties.value)}serialize(){return this.properties.value=this.get_value(),this.properties}}class ControlBoundingSlider extends ControlBase{set_value(e){this.jquery().slider({values:e}),$("#value-"+this.control_id()).html(e)}get_value(){return{value:this.jquery().slider("values"),max:this.properties.max,min:this.properties.min}}init_control(){var e="<div class='ControlSlider field control' id='"+this.place_id()+"' title='"+this.properties.help+"'   >",i=(e=(e+="<label style='margin-right: 20px;' for='"+this.control_id()+"'>"+this.properties.label+": <small id='value-"+this.control_id()+"' style='color:red' >"+this.properties.value+"</small></label>")+("<div style='width:100%;' class='slider' name='"+this.name+"' id='"+this.control_id()+"' ></div>")+"</div>",this.jquery_place().replaceWith(e),this);this.jquery().slider({range:!0,slide:function(e,t){$("#value-"+i.control_id()).html(t.value)},stop:function(){i.basewidget.fire_event(i.name,"update_control_event")},min:this.properties.min,max:this.properties.max,values:this.properties.value}),this.properties.required&&this.set_required()}}class ControlBreadcrumb extends ControlBase{init_control(){var e="<div class='field control ControlBreadcrumb' id='"+this.place_id()+"' >";if(e+='<div class="ui breadcrumb">',this.properties.value)for(var t=0;t<this.properties.value.length;t++){var i=this.properties.value[t],s=i.label,r=i.action_param,o=i.link,i=i.active?'class="active section"':'class="section"';o||r?e=e+('<a class="section" '+(i+=o?"href='"+o+"'":"action-param='"+r+"'"))+" >"+s+'</a><i class="right angle icon divider"></i>':e+="<div "+i+" >"+s+"</div>"}e+="</div></div>",this.jquery_place().replaceWith(e);var a=this;this.jquery().find("[action-param]").click(function(){var e=$(this).attr("action-param");a.properties.action_param=e,a.basewidget.fire_event(a.name,"pressed")}),this.properties.required&&this.set_required()}get_value(){return this.properties.value}update_server(){return!1}}class ControlButton extends ControlBase{init_control(){var html="<div class='field control ControlButton' id='"+this.place_id()+"'>",self=(this.properties.label_visible&&(html+="<label for='\"+this.control_id()+\"'>&nbsp;</label>"),html+=this.properties.labeled?"<div ":"<button type='button'",html+=" title='"+this.properties.help+"' id='"+this.control_id()+"' class='ui button' >",html+=this.properties.label,html+=this.properties.labeled?"</div>":"</button>",html+="</div>",this.jquery_place().replaceWith(html),this);this.jquery().click(function(){self.properties.value?eval(self.properties.value):self.basewidget.fire_event(self.name,"pressed")}),this.properties.required&&this.set_required()}get_value(){return this.properties.value}update_server(){return!1}deserialize(e){$.extend(this.properties,e),this.set_value(this.properties.value),this.jquery().html(this.properties.label),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlCalendar extends ControlBase{init_control(){var e=(e="<div id='"+this.place_id()+"' class='field control ControlCalendar' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label>")+this.create_calendar()+"</div>";this.jquery_place().replaceWith(e),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}create_calendar(){for(var e=new Date(this.properties.year,this.properties.month,0),t=new Date,i="<div class='ui seven column grid' id='"+this.control_id()+"' >",s=0;s<e.getDay();s++)i+="<div class='column'></div>";for(var r=1;r<=e.getDate();r++){if(e.getYear()==t.getYear()&&e.getMonth()==t.getMonth()&&r==t.getDate()?i+="<div class='column green'>"+r:i+="<div class='column'>"+r,this.properties.value&&r in this.properties.value){i+="<small>";for(var o=0;o<this.properties.value[r].length;o++)i+="</br>"+this.properties.value[r][o];i+="</small>"}i+="</div>"}return i+="</div>"}set_value(e){var t=this.create_calendar();$("#"+this.control_id()).replaceWith(t)}get_value(){return this.properties.value}}class ControlCheckBox extends ControlBase{set_value(e){e?this.jquery().prop("checked",!0):this.jquery().prop("checked",!1)}get_value(){return 0==this.jquery().length?this.properties.value:this.jquery().is(":checked")}init_control(){var e="<div class='field control ControlCheckBox' id='"+this.place_id()+"' >",t=(this.properties.label_visible?e+="<div style='height: 31px' ></div>":e+="<div style='height: 3px' ></div>",e=(e=(e+=`<div class='ui ${this.properties.checkbox_type} checkbox' >`)+("<input name='"+this.name+"' id='"+this.control_id()+"' type='checkbox' value='true' class='hidden' />"))+`<label title='${this.properties.help}' for='${this.control_id()}'>${this.properties.label}</label>`+"</div></div>",this.jquery_place().replaceWith(e),this.properties.value?this.jquery().prop("checked",!0):this.jquery().prop("checked",!1),this);this.jquery().click(function(){t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.visible||this.hide(void 0,!0),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}set_label(e){$(`#${this.place_id()} label[for='${this.control_id()}']`).first().html(e)}set_css(e){for(var t=0;t<this.added_classes.length;t++)this.jquery_place().children(".ui.checkbox").removeClass(this.added_classes[t]);for(var i=e.split(" "),t=0;t<i.length;t++)this.jquery_place().children(".ui.checkbox").addClass(i[t]);this.added_classes=i}}class ControlCheckBoxList extends ControlBase{constructor(e,t){super(e,t),this.being_edited=!1,this.update_server_flag=!1}init_control(){this.set_value(this.properties.value),this.properties.required&&this.set_required()}get_value(){var i;return this.properties.value?(i=this.properties.value.slice(0),$("#"+this.control_id()+" tbody tr").each(function(e,t){i[e][0]=$(this).find(".checkbox").checkbox("is checked")}),i):[]}set_value(e){this.load_table(),this.set_click_events()}load_table(){for(var e="<div id='"+this.place_id()+"' class='field control'>",t=(this.properties.label_visible&&(e+=`<label for="${this.control_id()}">${this.properties.label}</label>`),e=(e+="<table class='ui selectable celled table "+this.properties.css+" ControlCheckBoxList' id='"+this.control_id()+"' >")+"<thead>"+"<tr>",this.properties.headers),i=this.properties.columns_styles,s=0;s<t.length;s++)e+=`<th ${i?`style='${i[s]}'`:""} >${t[s]}</th>`;e+="</tr></thead><tbody>";var r=this.properties.value;if(null!=r)for(s=0;s<r.length;s++){for(var o=this.properties.selected_index==s,e=(e=(e=(e=e+`<tr row-id="${s}" >`+`<td class='collapsing ${o?"active":""}' >`)+("<div class='ui fitted "+(r[s][0]?"active":"")+" checkbox'>"))+("<input type='checkbox' "+(r[s][0]?"checked=''":"")+" />"))+"<label></label></div>"+"</td>",a=(a=r[s]?r[s].length:0)>t.length?t.length:a,l=1;l<a;l++)e+=`<td class='${o?"active":""}' >`+r[s][l]+"</td>";if(a<t.length)for(l=a;l<t.length;l++)e+=`<td class='${o?"active":""}'></td>`;e+="</tr>"}e+="</tbody></table></div>",this.jquery_place().replaceWith(e),this.changed=!1;var n=this;$("#"+this.control_id()+" .checkbox").checkbox({onChange:function(){n.changed=!0,n.basewidget.fire_event(n.name,"update_control_event")}})}set_click_events(){var t=this;$("#"+this.control_id()+" tbody td").click(function(){var e;$(this).hasClass("active")||(e=$(this).parent().attr("row-id"),t.update_server_flag=e!=t.properties.selected_index,t.properties.selected_index=e,t.basewidget.fire_event(t.name,"item_selection_changed_client_event"))})}update_server(){return this.changed||this.update_server_flag}serialize(){var e=super.serialize();return this.update_server_flag=!1,e}enable(){this.jquery().find("tr").removeAttr("disabled"),this.jquery().find("tr").removeClass("disabled")}disable(){this.jquery().find("tr").attr("disabled","true"),this.jquery().find("tr").addClass("disabled")}}class ControlCheckBoxListQuery extends ControlCheckBoxList{constructor(e,t){super(e,t),this.being_edited=!1}init_control(){this.set_value(this.properties.value),this.properties.required&&this.set_required()}get_value(){var i;return this.properties.value?(i=this.properties.value.slice(0),$("#"+this.control_id()+" tbody tr").each(function(e,t){i[e][0]=$(this).find(".checkbox").checkbox("is checked")}),i):[]}set_value(e){this.load_table()}load_table(){for(var e="<div id='"+this.place_id()+"' class='field control'>",t=(this.properties.label_visible&&(e+="<label for='\"+this.control_id()+\"'>"+this.properties.label+"</label>"),e=(e+="<table class='ui selectable celled table "+this.properties.css+" ControlCheckBoxList' id='"+this.control_id()+"' >")+"<thead>"+"<tr><th></th>",this.properties.headers),i=0;i<t.length;i++)e+="<th>"+t[i]+"</th>";e+="</tr></thead><tbody>";var s=this.properties.value,r=t.length+1;if(null!=s)for(i=0;i<s.length;i++){for(var e=(e=(e=(e=e+"<tr>"+"<td class='collapsing' >")+("<div class='ui fitted "+(s[i][0]?"active":"")+" checkbox'>"))+("<input type='checkbox' "+(s[i][0]?"checked=''":"")+" />"))+"<label></label></div>"+"</td>",o=r<(o=s[i]?s[i].length:0)?r:o,a=1;a<o;a++)e+="<td>"+s[i][a]+"</td>";if(o<r)for(a=o;a<r;a++)e+="<td></td>";e+="</tr>"}(this.properties.remove_button||this.properties.add_button)&&(e=(e+="<tfoot>")+'<tr><th colspan="'+r+'">',this.properties.add_button&&(e+='<div class="ui small button add-btn" >Add</div>'),this.properties.remove_button&&(e+='<div class="ui small button remove-btn" >Remove</div>'),e+="</th></tr></tfoot>"),e+="</tbody></table></div>",this.jquery_place().replaceWith(e);var l=this;$("#"+this.control_id()+" .checkbox").checkbox({onChange:function(){l.basewidget.fire_event(l.name,"update_control_event")}}),this.properties.remove_button&&$("#"+this.control_id()+" .remove-btn").click(function(){l.basewidget.fire_event(l.name,"remove_event")}),this.properties.add_button&&$("#"+this.control_id()+" .add-btn").click(function(){l.basewidget.fire_event(l.name,"add_event")})}enable(){this.jquery().find("tr").removeAttr("disabled"),this.jquery().find("tr").removeClass("disabled")}disable(){this.jquery().find("tr").attr("disabled","true"),this.jquery().find("tr").addClass("disabled")}}class ControlCodeMirror extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlCodeMirror' >",t=(this.properties.label_visible&&(e+="<label>"+this.properties.label+"</label>"),e=e+`<textarea id='${this.control_id()}' ></textarea>`+"</div>",this.jquery_place().replaceWith(e),document.getElementById(this.control_id())),i=(this.codemirror=CodeMirror(function(e){t.parentNode.replaceChild(e,t)},{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},autoRefresh:!0}),this);this.codemirror.on("blur",function(){i.basewidget.fire_event(i.name,"update_control_event")}),this.codemirror.setSize(this.properties.width,this.properties.height),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}get_value(){return this.codemirror.getValue()}set_value(e){this.codemirror.setValue(this.properties.value),this.codemirror.refresh()}}class ControlCombo extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlCombo' >",t=(this.properties.label_visible&&(e+=`<label for='${this.control_id()}'>${this.properties.label}</label>`),e+=`<div class='ui search dropdown selection' id='${this.control_id()}' >
					<i class="dropdown icon"></i>
					<div class="default text">${this.properties.placeholder}</div>
				 </div>`,this);this.jquery_place().replaceWith(e),this.jquery().dropdown(),this.jquery().dropdown("setup menu",{values:this.properties.items}),this.set_value(this.properties.value),this.jquery().dropdown("setting","onChange",function(){t.flag_exec_on_change_event&&t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}set_value(e){this.flag_exec_on_change_event=!1,this.jquery().dropdown("set exactly",[String(e)]),this.flag_exec_on_change_event=!0}get_value(){var e=this.jquery().dropdown("get value");return"None"==e?null:"true"==e||"false"!=e&&("null"==e?null:""==e?"":e)}deserialize(e){this.properties=$.extend(this.properties,e),this.jquery().dropdown("setup menu",{values:this.properties.items}),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlDate extends ControlBase{get_value(){return this.jquery().datepicker("getDate")}pad(e,t){for(var i=String(e);i.length<(t||2);)i="0"+i;return i}formatdate(e){return e.getFullYear()+"-"+this.pad(e.getMonth()+1,2)+"-"+this.pad(e.getDate(),2)}set_value(e){null!=e?this.jquery().val(this.formatdate(new Date(e))):this.jquery().val("")}serialize(){var e=this.get_value();return this.properties.value=null==e?null:e.getFullYear()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2),this.properties}init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlDate' ><label>"+this.properties.label+"</label><input placeholder='"+this.properties.placeholder+"' type='text' name='"+this.name+"' id='"+this.control_id()+"' /></div>",t=(this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.jquery().datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"1900:3000"}),this.set_value(this.properties.value),this);this.jquery().change(function(){t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlDateTime extends ControlBase{get_value(){return this.jquery().datetimepicker("getValue")}pad(e,t){for(var i=String(e);i.length<(t||2);)i="0"+i;return i}formatdate(e){return e.getFullYear()+"-"+this.pad(e.getMonth()+1,2)+"-"+this.pad(e.getDate(),2)+" "+this.pad(e.getHours(),2)+":"+this.pad(e.getMinutes(),2)}set_value(e){null!=e?this.jquery().val(this.formatdate(new Date(e))):this.jquery().val("")}init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlDateTime' ><label>"+this.properties.label+"</label><input placeholder='"+this.properties.placeholder+"' type='text' name='"+this.name+"' id='"+this.control_id()+"' value='' /></div>",t=(this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.jquery().datetimepicker({format:"Y-m-d H:i",formatTime:"H:i",formatDate:"Y-m-d"}),this);this.jquery().change(function(){t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlDir extends ControlBase{init_control(){var e="<div class='field control ControlDir' id='"+this.place_id()+"' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label>",t=(e=(e+="<input type='text' class='filename' basewidget='"+this.basewidget.widget_id+"' name='"+this.name+"' id='"+this.control_id()+"' value='"+this.properties.value+"'  placeholder='"+this.properties.label+"' />")+("<div class='ui modal' id='dialog"+this.control_id()+"' ><i class='close icon'></i><div class='header'>"+this.properties.label+"</div><div class='content' id='dialog-content-"+this.control_id()+"'  dom-id='"+this.control_id()+"' ></div></div>"),this.jquery_place().replaceWith(e),this);this.jquery().unbind("click"),this.jquery().click(function(){var e=get_current_folder();$("#dialog-content-"+t.control_id()).load(PYFORMS_SERVER_URL+"/pyforms/filesbrowser/?filter-folders=true&p="+e+"&control-id="+t.control_id(),function(){$("#dialog"+t.control_id()).modal("show")})}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ImageAnnotator{constructor(e,t){this.canvas=document.getElementById(e),(this.canvas.annotator=this).canvas.onwheel=this.onwheel,this.canvas.onmousemove=this.onmousemove,this.canvas.onmousedown=this.onmousedown,this.canvas.onmouseup=this.onmouseup,this.canvas.ondblclick=this.ondblclick,this.canvas.onmouseleave=this.onmouseleave,this.canvas.onmouseenter=this.onmouseenter,document.onkeydown=this.keydown,(document.annotator=this).ctx=this.canvas.getContext("2d"),this.img=new window.Image,(this.img.annotator=this).img.onload=this.on_load,this.x=0,this.y=0,this.width=0,this.height=0,this.mouse_is_hover=!1,this.zoom=1,this.xshift=0,this.yshift=0,this.update_evt=t,this.objects=[]}onmouseleave(e){(this instanceof ImageAnnotator?this:this.annotator).mouse_is_hover=!1}onmouseenter(e){(this instanceof ImageAnnotator?this:this.annotator).mouse_is_hover=!0}keydown(e){var t=this instanceof ImageAnnotator?this:this.annotator;if(!t.mouse_is_hover)return!0;8==(e.keyCode||e.charCode)&&t.active_idx&&(t.objects.splice(t.active_idx,1),t.edit_radius=!1,t.edit_center=!1,t.active_idx=void 0,t.draw(),t.update_evt())}clear(){this.objects=[],this.update()}add_object(e){(e.annotator=this).objects.push(e),e.update()}onwheel(e){var t=this instanceof ImageAnnotator?this:this.annotator;return t.do_zoom(e.deltaY),t.draw(),!1}image_coordinates(e,t){return[(e-this.x)/this.zoom,(t-this.y)/this.zoom]}ondblclick(e){var t=this instanceof ImageAnnotator?this:this.annotator,e=t.image_coordinates(e.offsetX,e.offsetY);t.add_object(new Circle(e[0],e[1],50)),t.draw(),t.update_evt()}onmouseup(e){var t=this instanceof ImageAnnotator?this:this.annotator;t.edit_center&&t.update_evt&&t.update_evt(),t.edit_radius&&t.update_evt&&t.update_evt(),t.edit_radius=!1,t.edit_center=!1,t.draw()}onmousedown(e){for(var t=this instanceof ImageAnnotator?this:this.annotator,i=0;i<t.objects.length;i++)switch(t.objects[i].is_mouse_hover(e.offsetX,e.offsetY)){case 1:return t.edit_center=!0,t.edit_radius=!1,t.active_idx=i,void t.draw();case 2:return t.edit_radius=!0,t.edit_center=!1,t.active_idx=i,void t.draw()}t.edit_center=!1,t.edit_radius=!1,this.active_idx=void 0,t.draw()}onmousemove(e){var t=this instanceof ImageAnnotator?this:this.annotator;if(e.which)t.edit_radius||t.edit_center?(i=t.objects[t.active_idx],t.edit_center?(i.move_to(e.offsetX,e.offsetY),t.draw()):t.edit_radius&&(i.screen_set_radius(i.screen_distance_to_center(e.offsetX,e.offsetY)),t.draw())):t.move(e.movementX,e.movementY);else for(var i,s=0;s<t.objects.length;s++){switch((i=t.objects[s]).is_mouse_hover(e.offsetX,e.offsetY)){case 1:return void(document.body.style.cursor="move");case 2:return void(document.body.style.cursor="col-resize")}document.body.style.cursor="default"}}update(){var e=this instanceof ImageAnnotator?this:this.annotator,t=e.img.width*e.zoom,i=e.img.height*e.zoom;this.x=e.canvas.width/2-t/2+e.xshift,this.y=e.canvas.height/2-i/2+e.yshift,this.width=t,this.height=i;for(var s=0;s<e.objects.length;s++)e.objects[s].update()}draw(){var e=this instanceof ImageAnnotator?this:this.annotator;e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.drawImage(e.img,e.x,e.y,e.width,e.height);for(var t=0;t<e.objects.length;t++)e.objects[t].draw(e.ctx,t==e.active_idx,t==e.active_idx&&e.edit_radius)}move(e,t){var i=this instanceof ImageAnnotator?this:this.annotator;i.xshift+=e,i.yshift+=t,i.xshift>i.canvas.width&&(i.xshift=i.canvas.width),i.xshift+i.img.width<0&&(i.xshift=-i.img.width),i.yshift>i.canvas.height&&(i.yshift=i.canvas.height),i.yshift+i.img.height<0&&(i.yshift=-i.img.height),i.update();for(var s=0;s<i.objects.length;s++)i.objects[s].update();i.draw()}do_zoom(e){var t=this instanceof ImageAnnotator?this:this.annotator;t.zoom+=-.01*e,t.zoom<.1&&(t.zoom=.1),20<t.zoom&&(t.zoom=20),t.update();for(var i=0;i<t.objects.length;i++)t.objects[i].update();t.draw()}on_load(){var e=this instanceof ImageAnnotator?this:this.annotator,t=e.img.width/e.img.height,i=e.canvas.width,s=e.canvas.height;1<t?(1<e.canvas.width/e.canvas.height?i=e.canvas.height*e.canvas.width/e.img.height:s=e.canvas.width*e.canvas.height/e.img.width,e.zoom=i/e.img.width):1<e.canvas.width/e.canvas.height?(s=e.canvas.width*e.canvas.height/e.img.width,e.zoom=s/e.img.height):(i=e.canvas.height*e.canvas.width/e.img.height,e.zoom=i/e.img.width),e.update(),e.draw()}set_value(e){this.img.src=e}}class Circle{constructor(e,t,i,s){this.annotator=void 0,this.x=e,this.y=t,this.radius=i,this.text=s,this._x=e,this._y=t,this._radius=i}update(){this._x=this.annotator.x+this.x*this.annotator.zoom,this._y=this.annotator.y+this.y*this.annotator.zoom,this._radius=this.radius*this.annotator.zoom}move_to(e,t){this._x=e,this._y=t,this.x=(e-this.annotator.x)/this.annotator.zoom,this.y=(t-this.annotator.y)/this.annotator.zoom}screen_distance_to_center(e,t){return Math.sqrt(Math.pow(this._x-e,2)+Math.pow(this._y-t,2))}screen_set_radius(e){this._radius=e,this.radius=e/this.annotator.zoom}draw(e,t,i,s,r,o){e.beginPath(),e.arc(this._x,this._y,1,0,2*Math.PI),e.strokeStyle=t?"#ff0000":"#00FF00",e.stroke(),this.text&&(e.font="12px Arial",e.fillStyle=i?"#ff0000":"#00FF00",e.textAlign="center",e.fillText(this.text,this._x,this._y-5)),e.beginPath(),e.arc(this._x,this._y,this._radius,0,2*Math.PI),e.strokeStyle=i?"#ff0000":"#00FF00",e.stroke(),e.beginPath(),e.rect(this._x-1.2*this._radius,this._y-1.2*this._radius,2*this._radius*1.2,2*this._radius*1.2),e.strokeStyle="rgba(225,0,0,0.5)",e.stroke()}is_mouse_hover(e,t){e=this.screen_distance_to_center(e,t);return e<=5?1:this._radius-2<=e&&e<=this._radius+2?2:void 0}}class ControlDrawInImg extends ControlBase{init_control(){var e=`<div id='${this.place_id()}' class='field control ControlDrawInImg' >`,e=(this.properties.label_visible&&(e+=`<label for='${this.control_id()}'>${this.properties.label}</label>`),e+=`<canvas id='${this.control_id()}' style='border:1px solid #d3d3d3;'>`,this.jquery_place().replaceWith(e),this.jquery_place().width()),t=this.jquery_place().height();t<500&&(t=500),this.jquery().attr("width",e),this.jquery().attr("height",t),this.annotator=new ImageAnnotator(this.control_id(),this.annotator_has_updated),(this.annotator.control=this).set_value(this.properties.value);for(var i=0;i<this.properties.circles.length;i++){var s=this.properties.circles[i];this.annotator.add_object(new Circle(s[0],s[1],s[2],s[3]))}this.properties.required&&this.set_required()}deserialize(e){super.deserialize(e),this.annotator.clear();for(var t=0;t<this.properties.circles.length;t++){var i=this.properties.circles[t];this.annotator.add_object(new Circle(i[0],i[1],i[2],i[3]))}this.annotator.update(),this.annotator.draw()}serialize(){var e=super.serialize();e.circles=[];for(var t=0;t<this.annotator.objects.length;t++){var i=this.annotator.objects[t];e.circles.push([i.x,i.y,i.radius,i.text])}return e}update_server(){return!0}annotator_has_updated(){this.control.basewidget.fire_event(this.control.name,"update_control_event")}set_value(e){this.annotator.set_value(e)}}class ControlEmail extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlEmail' ><label>"+this.properties.label+"</label><input placeholder='"+this.properties.label+"' type='text' name='"+this.name+"' id='"+this.control_id()+"' value='' /></div>",t=(this.jquery_place().replaceWith(e),this.properties.value?this.jquery().val(this.properties.value):this.jquery().val(""),this);this.jquery().change(function(){t.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlEmptyWidget extends ControlBase{init_control(){var e="",e=(void 0!==this.properties.html&&(e=Base64.decode(this.properties.html)),"<div id='"+this.place_id()+"' class='field control ControlEmptyWidget "+this.properties.css+"' >"+e+"</div>");this.jquery_place().replaceWith(e),void 0!==this.properties.child_widget_id&&pyforms.find_app(this.properties.child_widget_id).deserialize(this.properties.widget_data),this.set_value(this.properties.value),this.properties.required&&this.set_required()}serialize(){var e;return void 0!==this.properties.child_widget_id&&(e=pyforms.find_app(this.properties.child_widget_id),this.properties.widget_data=e.serialize(),0<e.events_queue.length)&&(this.properties.widget_data.event=e.events_queue.pop(0)),this.properties}deserialize(e){e.clear_widget&&(pyforms.remove_app(this.properties.child_widget_id),this.jquery_place().html(""),void 0===e.child_widget_id&&delete this.properties.child_widget_id,delete this.properties.clear_widget,delete e.clear_widget),void 0!==e.html&&(this.jquery_place().html(Base64.decode(e.html)),delete e.html),$.extend(this.properties,e),void 0!==this.properties.child_widget_id&&pyforms.find_app(this.properties.child_widget_id).deserialize(this.properties.widget_data),this.set_value(this.properties.value)}update_server(){return!0}}class ControlFeed extends ControlBase{init_control(){this.latest_element_id=null,this.loading=!1;var e="<div id='"+this.place_id()+"' class='field control'>",t=(e=(e+='<div class="ui '+this.properties.mode+' ControlFeed"  id="'+this.control_id()+'">')+"</div>"+"</div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value),null!=this.properties.value&&0!=this.properties.value.length||this.jquery().html(this.properties.empty_message),this);this.jquery().visibility({once:!1,observeChanges:!0,onBottomVisible:function(){t.properties.has_more&&!t.loading&&(loading=!0,t.properties.action_param=t.latest_element_id,t.basewidget.fire_event("self","load_more"))}}),this.properties.required&&this.set_required()}get_value(){return this.properties.value}set_value(e){if(0!=e.length){for(var t=0,t=0;t<e.length;t++){var i=this.jquery().find('[pk="'+e[t].pk+'"]'),s=$(e[t].html);s.attr("pk",e[t].pk),0<i.length?i.replaceWith(s):this.jquery().append(s),this.set_actions(s),this.latest_element_id=e[t].pk}this.loading=!1}}set_actions(i){this.properties.action_param=void 0;var s=this;i.find("[action]").click(function(){var e=$(this).attr("action"),t=$(this).attr("action-param");s.properties.action_param=t,s.basewidget.fire_event("self",e)}),i.attr("action")&&i.click(function(){var e=i.attr("action"),t=i.attr("action-param");s.properties.action_param=t,s.basewidget.fire_event("self",e)})}deserialize(e){$.extend(this.properties,e),this.properties.clear&&this.jquery().empty(),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}update_server(){return null!=this.properties.action_param}}function add_file2control(e,t){$("#dialog"+e).modal("hide"),$("#"+e).val(t);t=pyforms.split_id(e),e=t[0],t=t[1];pyforms.find_app(e).fire_event(t,"update_control_event")}class ControlFile extends ControlBase{init_control(){var e=this.properties.value||"",t="<div class='field control ControlFile' id='"+this.place_id()+"' >",i=(this.properties.label_visible&&(t+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),t=t+("<input type='text' class='filename' name='"+this.name+"' id='"+this.control_id()+"' value='"+e+"'  placeholder='"+this.properties.label+"' />")+"</div>",this.jquery_place().replaceWith(t),this);this.jquery().click(function(){i.basewidget.fire_event(i.name,"open_file_browser")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlFileUpload extends ControlBase{init_control(){var e="<div class='field control ControlFileUpload' id='"+this.place_id()+"' >",l=(this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e=e+('<input type="file" name="'+this.name+'" id="'+this.control_id()+'" placeholder="'+this.properties.placeholder+'" >')+"</div>",this.jquery_place().replaceWith(e),this);this.jquery().filer({uploadFile:{url:PYFORMS_SERVER_URL+"/pyforms/upload-files/",data:{app_id:this.app_id(),control_id:this.name},type:"POST",enctype:"multipart/form-data",synchron:!1,beforeSend:function(){l.basewidget.loading()},success:function(e,t,i,s,r,o,a){l.properties.new_value=e.metas[0].file,l.basewidget.fire_event(l.name,"update_control_event"),l.basewidget.not_loading()},error:null,statusCode:null,onProgress:null,onComplete:null},showThumbs:!0,limit:1,addMore:!0,allowDuplicates:!1,onRemove:function(e,t,i,s,r,o,a){l.properties.new_value="",l.basewidget.fire_event(l.name,"update_control_event")}}),this.properties.file_data&&this.jquery().prop("jFiler").append(this.properties.file_data),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}get_value(){return void 0===this.properties.new_value?this.properties.value:this.properties.new_value}set_value(e){var t=this.jquery().prop("jFiler");t.reset(),this.properties.file_data&&t.append(this.properties.file_data)}deserialize(e){this.properties.file_data=void 0,this.properties.new_value=void 0,this.properties=$.extend(this.properties,e),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlFloat extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlFloat' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label><input placeholder='"+this.properties.label+"' type='text' name='"+this.name+"' id='"+this.control_id()+"' /></div>",t=(this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this);this.jquery().change(function(){t.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}get_value(){var e=this.jquery().val();return null==e||"null"==e||0==e.length?null:e}set_value(e){null!=e?this.jquery().val(e):this.jquery().val("")}}class ControlHighlightText extends ControlBase{init_control(){var e=`<div id='${this.place_id()}' class='field control ControlHighlightText' >
            <div class="ui compact mini menu blue toolbar-edit" style="position: absolute; display: none; z-index: 999" >
              <a class="item remove"> <i class="window close outline icon"></i></a>
              <a class="item comment"> <i class="comment alternate outline icon"></i></a>
            </div>
            <br/>
            <br/>
		    <label for='${this.control_id()}'>${this.properties.label}</label>
		    <div placeholder='${this.properties.placeholder}' type='text'
		    rows='${this.properties.rows}' cols='${this.properties.cols}'
		    name='${this.name}' id='${this.control_id()}' ></div>
		</div>`,i=(this.jquery_place().replaceWith(e),this.set_value(this.properties.value),new TextHighlighter($("#"+this.control_id())[0],{onAfterHighlight:e=>{$(".highlighted").unbind("click"),$(".highlighted").click(t=>{var e=this.jquery_place().offset();this.jquery_place().find(".toolbar-edit").css({left:t.pageX-e.left,top:t.pageY-e.top+45}).show(),this.jquery_place().find(".toolbar-edit .remove").unbind("click"),this.jquery_place().find(".toolbar-edit .remove").click(e=>{i.removeHighlights(t.currentTarget),this.jquery_place().find(".toolbar-edit").hide()})})}}));this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required(),this.jquery_place().find(".menu .item").click(function(){$(this).parents().find(".menu .item").removeClass("active"),$(this).addClass("active")})}enable(){this.jquery().removeAttr("readonly"),this.jquery().removeClass("disabled")}disable(){this.jquery().attr("readonly","readonly"),this.jquery().addClass("disabled")}set_value(e){0<this.jquery().length&&(null!=this.properties.value?this.jquery().html(this.properties.value):this.jquery().html(""))}get_value(){var e;return 0==this.jquery().length?this.properties.value:"null"==(e=this.jquery().html())?null:e}}class ControlHtml extends ControlBase{init_control(){var e='<div id="'+this.place_id()+'" class="field control ControlHtml">';this.properties.label_visible&&(e+="<label for='\"+this.control_id()+\"'>"+this.properties.label+"</label>"),e=e+('<div id="'+this.control_id())+'"></div></div>',this.jquery_place().replaceWith(e),this.properties.value?this.jquery().html(this.properties.value):this.jquery().html(""),this.properties.required&&this.set_required()}set_value(e){this.properties.value?this.jquery().html(this.properties.value):this.jquery().html("")}}class ControlImage extends ControlBase{get_value(){return this.jquery().attr("src")}set_value(e){e.base64?this.jquery().attr("src","data:image/png;base64,"+e.base64):this.jquery().attr("src",e.url)}init_control(){var e=(e=(e=(e="<div id='"+this.place_id()+"' class='field control ControlImage' >")+("<div class='ui card' id='card"+this.control_id()+"' >")+"<div>")+("<img id='"+this.control_id()+"' />")+"</div>")+"</div>"+"</div>";this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}}class ControlImg extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlImg' >";this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e+="<span id='"+this.control_id()+"' ></span></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}get_value(){return this.properties.value}set_value(e){e=e?'<img id="'+this.control_id()+'"" class="ui image '+this.properties.css+'" src="'+e+'">':"<span id='"+this.control_id()+"' ></span>",this.jquery().replaceWith(e)}}class ControlImgViewer extends ControlBase{init_control(){var e=`<div id='${this.place_id()}' class='field control ControlImgViewer' >`;this.properties.label_visible&&(e+=`<label for='${this.control_id()}'>${this.properties.label}</label>`),e+=`<div id='${this.control_id()}' style="min-height: ${this.properties.min_height}px;" ></div>`,this.jquery_place().replaceWith(e),this.properties.value&&this.set_value(this.properties.value),this.properties.required&&this.set_required()}set_value(e){this.zoomist&&(this.zoomist.destroy(),this.zoomist=void 0),void 0!==e&&""!==e&&(this.jquery().attr("data-zoomist-src",e),this.zoomist=new Zoomist("#"+this.control_id(),{fill:this.properties.fill,slider:{direction:"vertical"}}))}}class ControlInteger extends ControlBase{init_control(){var e=`<div id='${this.place_id()}' class='field control ControlInteger' >
					<label for='${this.control_id()}' >${this.properties.label}</label>
					<input placeholder='${this.properties.placeholder}' type='text' name='${this.name}' id='${this.control_id()}' />
					</div>`;this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.jquery().change(()=>{this.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlItemsList extends ControlBase{constructor(e,t){super(e,t),this.being_edited=!1}init_control(){var e="<div id='"+this.place_id()+"' class='field control'>",e=(e+='<div class="ui divided items ControlItemsList"  id="'+this.control_id()+'">')+"</div>"+"</div>";this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}get_value(){return this.properties.value}set_value(e){html="";for(var t=0;t<e.length;t++){this.properties.selected_index;if(html+='<div class="item">',e[t].img&&(html=(html+='<div class="image">')+'<img src="'+e[t].img+'"></div>'),html+='<div class="content">',e[t].title&&(html+='<a class="header">'+e[t].title+"</a>"),e[t].meta&&(html=(html+='<div class="meta">')+"<span>"+e[t].meta+"</span></div>"),e[t].text&&(html=(html+='<div class="description">')+"<p>"+e[t].text+"</p></div>"),e[t].tags||this.properties.select_btn_label){if(html+='<div class="extra">',this.properties.select_btn_label&&(html=(html+='<div row-number="'+t+'" class="ui right floated primary mini button">')+this.properties.select_btn_label+"</div>"),e[t].tags)for(var i=0;i<e[t].tags.length;i++)html+='<div class="ui label">'+e[t].tags[i]+"</div>";html+="</div>"}html=html+"</div>"+"</div>"}this.jquery().html(html);var s=this;this.jquery().find(".extra .button").click(function(){s.properties.selected_index=$(this).attr("row-number"),s.basewidget.fire_event(s.name,"item_selection_changed_event")})}update_server(){return!0}}class ControlLabel extends ControlBase{get_value(){return this.properties.value}init_control(){console.debug(this.properties);var e='<div class="ui field '+this.properties.css+' message control ControlLabel" id="'+this.place_id()+'"  >',e=(e=(e+='<div class="header">')+this.properties.label+"</div>")+`<p id="${this.control_id()}">`;null==this.properties.value&&null==this.properties.value||(e+=this.properties.value),e+="</p></div>",this.jquery_place().replaceWith(e),this.properties.required&&this.set_required()}set_value(e){this.init_control()}}class ControlLineChart extends ControlBase{init_control(){this.update_it=!1;var e="<div id='"+this.place_id()+"' class='field control ControlLineChart' >";this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e=e+("<div id='"+this.control_id()+"' title='"+this.properties.help)+"' style='margin-left: 20px' ></div></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}set_value(e){this.chart&&this.chart.destroy();var t=this.properties.legend;e&&0!=e.length&&0!=e[0].length||(e=[[[0,0]]]),this.chart=$.jqplot(this.control_id(),e,{height:this.properties.height,width:this.properties.width,seriesColors:["#f2711c","#fbbd08","#b5cc18","#21ba45","#00b5ad","#2185d0","#6435c9","#a333c8","#e03997","#a5673f","#767676","#1b1c1d","#DB2828"],grid:{borderColor:"transparent",shadow:!1,drawBorder:!1,shadowColor:"transparent",background:"transparent"},title:this.label,seriesDefaults:{showMarker:!0,showLine:!0,lineWidth:1,markerOptions:{size:4},rendererOptions:{smooth:this.properties.smooth}},legend:{show:0<t.length,labels:t,placement:this.properties.legend_placement,location:this.properties.legend_location},axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:this.properties.x_axis_format}}},cursor:{style:"pointer",show:!0,zoom:!0,tooltipOffset:10,showTooltip:!0,followMouse:!0,showTooltipDataPosition:!0,showVerticalLine:!0}});const r=this;this.jquery().bind("jqplotDataClick",function(e,t,i,s){r.properties.selected_series=t,r.properties.selected_data=s,r.update_it=!0,r.basewidget.fire_event(r.name,"remote_data_selected_event")})}update_server(){return this.get_value()!=this.properties.value||this.update_it}deserialize(e){this.properties=$.extend(this.properties,e)}apply_deserialization(e){super.apply_deserialization(e),this.set_value(this.properties.value)}serialize(){return this.properties.value=this.get_value(),this.properties}}class ControlList extends ControlBase{constructor(e,t){super(e,t),this.being_edited=!1}init_control(){var e=`<div id='${this.place_id()}' class='field control ControlList'>`;this.properties.label_visible&&(e+=`<label for='${this.control_id()}'>${this.properties.label}</label>`),e=e+`<div style='overflow-x: auto;'><span id='${this.control_id()}' ></span></div>`+"</div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}get_value(){var s=[];return $("#"+this.control_id()+" tbody tr").each(function(e,t){var i=[];$(this).children("td").each(function(e,t){i.push($(t).html())}),s.push(i)}),s}set_value(e){this.load_table()}load_table(){let e="";e=(e+="<table class='ui selectable celled table "+this.properties.css+"' id='"+this.control_id()+"' >")+"<thead><tr>";for(var t=this.properties.columns_align,i=this.properties.columns_size,s=this.properties.horizontal_headers,r=0;r<s.length;r++)e+=`<th style='${i?"width:"+i[r]:""}; ${t?"text-align:"+t[r]:""}' >${s[r]}</th>`;e+="</tr></thead>";var o=this.properties.value;if(e+="<tbody></div>",null!=o)for(r=0;r<o.length;r++){var a=this.properties.selected_index==r,l=(e+="<tr>",0);o[r]&&(l=o[r].length);for(var n=0;n<l;n++)e+=a?`<td style='${t?"text-align:"+t[n]:""}' class='active' >${o[r][n]}</td>`:`<td style='${t?"text-align:"+t[n]:""}' >${o[r][n]}</td>`;if(l<s.length)for(n=l;n<s.length;n++)e+=a?"<td class='active' ></td>":"<td></td>";e+="</tr>"}e+="</tbody></table>",this.jquery().replaceWith(e);var h=this;this.properties.read_only?$("#"+this.control_id()+" tbody td").dblclick(function(){h.basewidget.fire_event(h.name,"row_double_click_event")}):$("#"+this.control_id()+" tbody td").dblclick(function(){if(h.being_edited)return!1;h.being_edited=!0;var e=$(this),t=e.html();e.html('<div class="ui input"><input type="text" value="'+t+'" /></div>'),e.find("input").focus(),e.find("input").focusout(function(){e.html($(this).val()),h.being_edited=!1,h.basewidget.fire_event(h.name,"update_control_event")})}),$("#"+this.control_id()+" tbody td").click(function(){$(this).hasClass("active")||($("#"+h.control_id()+" tbody td").removeClass("active"),$("#"+h.control_id()+" tbody tr").removeClass("active"),(h.properties.select_entire_row?$(this).parent().find("td"):$(this)).addClass("active"),h.properties.selected_index=$("#"+h.control_id()+" tbody tr").index($(this).parent()),h.basewidget.fire_event(h.name,"item_selection_changed_event"))}),$("#"+this.control_id()+" thead th").click(function(){$("#"+h.control_id()+" tbody td").removeClass("active"),$("#"+h.control_id()+" tbody tr").removeClass("active"),h.properties.selected_index=-1,h.basewidget.fire_event(h.name,"item_selection_changed_event")})}}class ControlMap extends ControlBase{init_control(){super.init_control(),this.jquery_place().replaceWith(`<div id='${this.place_id()}' class='field control ControlMap' >
                ${this.properties.label_visible?`<label for="${this.control_id()}">${this.properties.label}</label>`:""}
                <div style="min-height: ${this.properties.min_height}px;" id='${this.control_id()}' placeholder='${this.properties.placeholder}' />
            </div>`),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required(),setTimeout(()=>{this.initMap()},500)}initMap(){var e=this.properties.value;this.map=L.map(this.control_id()).setView(this.properties.center,this.properties.zoom),e&&e.forEach(e=>{L.tileLayer(e.url,e.options).addTo(this.map)}),this.initEditPolygon(),this.process_commands()}initEditPolygon(){this.editableLayers=new L.FeatureGroup,this.map.addLayer(this.editableLayers);var e={position:"topleft",draw:{polyline:this.properties.edit_polyline,polygon:this.properties.edit_polygon,marker:this.properties.edit_marker,circlemarker:this.properties.edit_circlemarker,circle:this.properties.edit_circle,rectangle:this.properties.edit_rectangle},edit:{featureGroup:this.editableLayers,remove:!0}};this.drawControl=new L.Control.Draw(e),this.map.addControl(this.drawControl),this.map.on(L.Draw.Event.CREATED,e=>{this.editableLayers.addLayer(e.layer),this.basewidget.fire_event(this.name,"update_control_event")}),this.map.on(L.Draw.Event.EDITED,e=>{this.basewidget.fire_event(this.name,"update_control_event")}),this.map.on(L.Draw.Event.DELETED,e=>{this.basewidget.fire_event(this.name,"update_control_event")})}process_commands(){this.properties.add_markers&&this.properties.add_markers.forEach((e,t)=>{e=L.marker(e.coordinate,e);this.editableLayers.addLayer(e)}),this.properties.add_polygons&&this.properties.add_polygons.forEach(e=>{e=L.polygon(e.coordinates,e);this.editableLayers.addLayer(e)}),this.properties.add_markers=[],this.properties.add_polygons=[],this.properties.fitBounds&&this.map&&this.editableLayers.getBounds().isValid()&&this.map.fitBounds(this.editableLayers.getBounds())}serialize(){const t=[],i=[];return this.map.eachLayer(e=>{e instanceof L.Polygon?t.push(e.toGeoJSON()):e instanceof L.Marker&&e.options&&"markerPane"===e.options.pane&&i.push(e.toGeoJSON())}),this.properties.polygons=t,this.properties.markers=i,super.serialize()}deserialize(e){super.deserialize(e),this.properties.fitBounds&&this.map&&this.editableLayers.getBounds().isValid()&&this.map.fitBounds(this.editableLayers.getBounds()),this.map&&this.process_commands()}}class ControlMenu extends ControlBase{get_value(){return this.properties.value}init_control(){var e='<div id="'+this.place_id()+'" class="field control ControlMenu">';this.properties.label&&(e+="<label for='\"+this.control_id()+\"'>"+this.properties.label+"</label>"),e+='<div id="'+this.control_id()+'" class="ui vertical accordion menu">',menu=this.properties.value;for(var t=0;t<menu.length;t++){for(var e=(e+='<div class="item">')+('<a class="active title"><i class="dropdown icon"></i> <b>'+menu[t][0]+"</b></a>")+'<div class="active content menu">',i=0;i<menu[t][1].length;i++)e+='<a class="item" href="javascript:pyforms.find_app(\''+this.app_id()+"').fire_event('self', '"+menu[t][1][i][1]+"');\">"+menu[t][1][i][0]+"</a>";e=e+"</div>"+"</div>"}e+="</div></div>",this.jquery_place().replaceWith(e),this.jquery_place().accordion({exclusive:!1}),this.properties.required&&this.set_required()}set_value(e){this.init_control()}}class ControlMultipleChecks extends ControlBase{set_value(e){if(this.flag_exec_on_change_event=!1,null==e||0==e.length)$("#"+this.place_id()+" .ui.checkbox").checkbox("uncheck");else for(var t=0;t<this.properties.items.length;t++){var i=this.properties.items[t],s=$("#"+this.place_id()+' .ui.checkbox[value="'+i.value+'"]');-1<e.indexOf(i.value)?s.checkbox("set checked"):s.checkbox("set unchecked")}this.flag_exec_on_change_event=!0}get_value(){for(var e=[],t=0;t<this.properties.items.length;t++){var i=this.properties.items[t];$("#"+this.place_id()+' .ui.checkbox[value="'+i.value+'"]').checkbox("is checked")&&e.push(i.value)}return e}init_control(){var e="<div class='field control ControlMultipleChecks' id='"+this.place_id()+"' >";this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e+='<div class="ui grid">';for(var t=0;t<this.properties.items.length;t++)var i=this.properties.items[t],e=(e=(e=(e=(e+='<div class="five wide column">')+('<div class="ui checkbox" value="'+i.value+'" >'))+('<input type="checkbox" value="'+i.value+'" name="'+this.properties.name+'">'))+("<label>"+i.text+"</label>"))+"</div>"+"</div>";e+="</div></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value);var s=this;$("#"+this.place_id()+" .ui.checkbox").checkbox({onChange:function(){s.flag_exec_on_change_event&&s.basewidget.fire_event(this.name,"update_control_event")}}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlMultipleSelection extends ControlBase{set_value(e){this.flag_exec_on_change_event=!1,this.jquery().dropdown("set exactly",e),this.flag_exec_on_change_event=!0}get_value(){var e=this.jquery().dropdown("get value");return 0==e.length?[]:e.split(",").sort()}init_control(){var e="<div class='field control ControlMultipleSelection' id='"+this.place_id()+"' >",t=(this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e="scrolling"===this.properties.mode?(e+="<div class='ui dropdown multiple scrolling' id='"+this.control_id()+"'>")+'<div class="default text">'+this.properties.label+'</div><i class="dropdown icon"></i><div class="menu"></div></div>':(e=e+("<div class='ui search dropdown multiple selection' id='"+this.control_id())+'\'><i class="dropdown icon"></i>')+'<div class="default text">'+this.properties.label+"</div></div>",this.jquery_place().replaceWith(e),this);this.jquery_place().replaceWith(e),this.jquery().dropdown({forceSelection:!1,allowReselection:!1,hideAdditions:!0}),this.jquery().dropdown("setup menu",{values:this.properties.items}),this.set_value(this.properties.value),this.jquery().dropdown("setting","onChange",function(){t.flag_exec_on_change_event&&t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}deserialize(e){var t=this.properties.value;this.properties=$.extend(this.properties,e),this.properties.update_items&&this.jquery().dropdown("setup menu",{values:this.properties.items}),null==this.properties.value?this.set_value(null):t.toString()!=this.properties.value.toString()&&this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlMultipleUpload extends ControlBase{init_control(){var t,e=(e="<div class='field control ControlMultipleUpload' id='"+this.place_id()+"' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label>")+('<input type="file" name="'+this.name+'" id="'+this.control_id()+'" placeholder="'+this.properties.label+'" >')+"</div>";this.modified=!1,this.jquery_place().replaceWith(e),this.properties.new_value=[],this.files=[],this.jquery().filer({uploadFile:{url:PYFORMS_SERVER_URL+"/pyforms/upload-files/",data:{app_id:this.app_id(),control_id:this.name},type:"POST",enctype:"multipart/form-data",synchron:!1,success:(e,t,i,s,r,o,a)=>{this.files.push(e.metas[0])},onComplete:(e,t,i,s,r,o)=>{this.modified=!0,this.properties.new_value=this.files.map(e=>e.file),console.debug("--",this.properties.new_value),this.basewidget.fire_event(this.name,"update_control_event")},error:null,statusCode:null,onProgress:null},showThumbs:!0,addMore:!0,allowDuplicates:!1,onRemove:(e,t,i,s,r,o,a)=>{this.modified=!0,this.properties.new_value=this.properties.value.filter(e=>0!==e.localeCompare(t.file)),console.debug(this.properties.value,t.file,this.properties.new_value),this.basewidget.fire_event(this.name,"update_control_event")}}),this.properties.file_data&&(t=this.jquery().prop("jFiler"),this.properties.file_data)&&this.properties.file_data.forEach(e=>{t.append(e)}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}update_server(){return this.modified}get_value(){return void 0===this.properties.new_value?this.properties.value:this.properties.new_value}set_value(e){var t=this.jquery().prop("jFiler");t.reset(),this.properties.file_data&&this.properties.file_data.forEach(e=>{t.append(e)})}serialize(){var e=super.serialize();return this.modified=!1,e}deserialize(e){this.properties.file_data=void 0,this.properties.new_value=void 0,this.properties=$.extend(this.properties,e),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlOrganogram extends ControlBase{init_control(){var e=`
            <div class='field control ControlOrganogram' id='${this.place_id()}' >
            </div>`;this.jquery_place().replaceWith(e),this.place_id(),conf.concat(this.properties.value);this.graph=new Treant(chart_config),this.properties.required&&this.set_required()}}class ControlPassword extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlPassword' ><label>"+this.properties.label+"</label><input placeholder='"+this.properties.label+"' type='password' name='"+this.name+"' id='"+this.control_id()+"' /></div>",t=(this.jquery_place().replaceWith(e),this);this.jquery().change(function(){t.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlPieChart extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlPieChart' >",e=(this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e=(e=(e+="<div id='chart-container-"+this.control_id()+"' title='"+this.properties.help+"'   >")+("<div id='"+this.control_id()+"' ></div>"))+"</div>"+"</div>",this.jquery_place().replaceWith(e),this.properties.value),e=(e&&0!=e.length||(e=[["Empty",0]]),jQuery.jqplot(this.control_id(),[e],{seriesColors:["#f2711c","#fbbd08","#b5cc18","#21ba45","#00b5ad","#2185d0","#6435c9","#a333c8","#e03997","#a5673f","#767676","#1b1c1d","#DB2828"],seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0}},legend:{show:!0,rendererOptions:{numberRows:e.length/3},placement:this.properties.legend_placement,location:this.properties.legend_location}}));(this.chart=e).themeEngine.newTheme("simple",{seriesStyles:{shadow:!1,gridBorderWidth:0,color:"white"},grid:{backgroundColor:"white",borderWidth:0,gridLineColor:"white",gridLineWidth:0,borderColor:"white",shadow:!1},legend:{background:"white",textColor:"#CCC",border:"0px solid white"}}),e.activateTheme("simple"),this.properties.required&&this.set_required()}set_value(e){e={data:[e],legend:{show:!0,rendererOptions:{numberRows:e.length/3},placement:"outside",location:"s"}};this.chart.replot(e)}get_value(){return this.properties.value}}class ControlPlayer extends ControlBase{get_value(){return this.properties.video_index=$("#timeline"+this.control_id()).val(),this.properties.value}set_value(e){this.properties.base64content&&($("#display"+this.control_id()).attr("src","data:image/png;base64,"+this.properties.base64content),$("#timeline"+this.control_id()).val(this.properties.video_index),$("#timeline"+this.control_id()).attr("min",0),$("#timeline"+this.control_id()).attr("max",this.properties.endFrame))}init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlPlayer' >",t=(e=(e=(e=(e=(e=e+("<div class='ui card "+this.properties.css+"' id='card"+this.control_id()+"' >")+"<div class='image'>")+("<img style='width:100%;' class='image' src='data:image/png;base64,"+this.properties.base64content+"' id='display"+this.control_id()+"' />"))+"</div>"+"<div class='content'>")+("<input style='width:100%;' type='range' name='"+this.name+"' value='"+this.properties.value+"' id='timeline"+this.control_id()+"' max='"+this.properties.endFrame+"'>")+"</div>")+"</div>"+"</div>",this.jquery_place().replaceWith(e),this);$("#timeline"+this.control_id()).change(function(){t.basewidget.fire_event(t.name,"refresh")}),this.properties.required&&this.set_required()}update_server(){return this.properties.video_index!=$("#timeline"+this.control_id()).val()}serialize(){return super.serialize(),this.properties.base64content=null,this.properties}}class ControlPlayerJs extends ControlBase{init_control(){var e=`
            <div id='`+this.place_id()+`' class='field control ControlPlayerJs' >
                <video class="video" id="`+this.control_id()+`" muted >
                    <source src="`+this.properties.value+`">
                    Your browser does not support HTML5 video.
                </video>
                <div style='background-color:black' ><canvas class="canvas" id="canvas-`+this.control_id()+`" ></canvas></div>
                <div class="video-timeline" id="timeline-`+this.control_id()+`" >
                    <div class="video-timeline-passed"></div>
                    <div class="video-timeline-loaded"></div>
                </div>
                <div class='video-graph'></div>
            <div>`,t=(this.jquery_place().replaceWith(e),this);$(document).ready(function(){t.video=new CanvasVideoPlayer({playerSelector:"#"+t.place_id(),videoSelector:"#"+t.control_id(),canvasSelector:"#canvas-"+t.control_id(),timelineSelector:"#timeline-"+t.control_id(),audio:!1,video_width:t.properties.video_width,video_height:t.properties.video_height,draws_url:t.properties.draws_url})}),this.properties.required&&this.set_required()}load_data(){var i;this.properties.data_url&&(i=this,$.ajax({method:"get",cache:!1,dataType:"json",url:this.properties.data_url+"?nocache="+$.now(),contentType:"application/json; charset=utf-8",success:function(e){if(e.graphs)for(var t in e.graphs)i.video.add_graph(e.graphs[t].title,e.graphs[t].data,e.graphs[t].color);if(e.events){for(var t in e.events)i.video.add_event(e.events[t][0],e.events[t][1],e.events[t][2],e.events[t][3],e.events[t][4]);i.video.draw_timeline()}}}).always(function(){i.properties.data_url=void 0}))}get_value(){return null}set_value(e){this.video.open(e)}update_server(){return!1}deserialize(e){super.deserialize(e),this.load_data()}}class ControlProgress extends ControlBase{init_control(){var e=`<div id='${this.place_id()}' class='field control ControlProgress' >
		    <div title='${this.properties.help}' class="ui progress" id='${this.control_id()}'>
			  <div class="bar">
				<div class="progress"></div>
			  </div>
			  ${this.properties.label_visible?`<div class="label" for="${this.control_id()}">${this.properties.label}</div>`:""}
			</div>
		</div>`;this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}set_value(e){this.jquery().progress({total:this.properties.max,value:this.properties.value})}set_label(e){$(`#${this.place_id()} .label[for='${this.control_id()}']`).first().html(e)}}class ControlQueryCards extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control'>",t=this.properties.filters_list;if(0<t.length){e+="<div class='fields'>";for(var i=0;i<t.length;i++){for(var e=(e=(e+="<div class='field'>")+("<label for='"+this.control_id()+"-filter-"+t[i].column+"'>"+t[i].label+"</label>"))+("<select class='ui search dropdown queryset-filter' column='"+t[i].column+"' id='"+this.control_id()+"-filter-"+t[i].column+"' >")+"<option value='000000000000'>--- None ---</label>",s=t[i].items,r=0;r<s.length;r++)e+="<option value='"+s[r]+"'>"+s[r]+"</label>";e=e+"</select>"+"</div>"}e+="</div>"}e+="<div class='ui link cards' id='"+this.control_id()+"' ></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value);var o=this,o=($("#"+this.place_id()+" .queryset-filter").dropdown({onChange:function(){o.properties.filter_by=[],$("#"+o.place_id()+" .queryset-filter").each(function(){var e,t=$(this).dropdown("get value");""!=t&&"000000000000"!=t&&(e=$(this).find("select").attr("column"),o.properties.filter_by.push({[e]:t}))}),o.basewidget.fire_event(o.name,"filter_changed_event")}}),this);$("#"+this.control_id()+" thead th").click(function(){$("#"+o.control_id()+" tbody td").removeClass("active"),$("#"+o.control_id()+" tbody tr").removeClass("active"),o.properties.selected_index=-1,$(this).hasClass("ascending")?($(this).removeClass("ascending"),$(this).addClass("descending")):$(this).hasClass("descending")?($(this).removeClass("sorted"),$(this).removeClass("descending")):($(this).addClass("sorted"),$(this).addClass("ascending")),o.properties.sort_by=[],$("#"+o.control_id()+" thead th").each(function(e){var t;($(this).hasClass("ascending")||$(this).hasClass("descending"))&&(t={column:$(this).attr("column"),desc:$(this).hasClass("descending")},o.properties.sort_by.push(t))}),o.basewidget.fire_event(o.name,"sort_changed_event")}),this.properties.required&&this.set_required()}get_value(){}set_value(e){this.properties.horizontal_headers;for(var t=this.properties.values,i="",s=0;s<t.length;s++){var r=this.properties.selected_row_id==t[s][0];i+="<div class='card' row-id='"+t[s][0]+"' >";for(var o=1;o<t[s].length;o++)i+="<div class='content "+(r?"active":"")+"' >"+t[s][o]+"</div>";i+="</div>"}$("#"+this.control_id()).html(i);var a="",l=this.properties.pages.pages_list;if(1<l.length){a+='<div class="ui right floated pagination menu small">';5<l.length-1?l.length:l.length;0<l[0]&&(a+='<a class="icon item" pageindex="'+l[0]+'" ><i class="left chevron icon"></i></a>');for(s=1;s<l.length-1;s++)a+='<a pageindex="'+l[s]+'" class="item '+(l[s]==this.properties.pages.current_page?"active":"")+'">'+l[s]+"</a>";0<l[l.length-1]&&(a+='<a pageindex="'+l[l.length-1]+'" class="icon item"><i class="right chevron icon"></i></a>'),a+="</div>",$("#"+this.control_id()).append(a)}this.set_click_events()}set_click_events(){var e=this;$("#"+this.control_id()+" tbody td").click(function(){$(this).hasClass("active")||(e.properties.selected_row_id=$(this).parent().attr("row-id"),e.basewidget.fire_event(e.name,"item_selection_changed_client_event"))}),$("#"+this.control_id()+" .pagination .item").click(function(){$(this).hasClass("active")||(e.properties.pages.current_page=$(this).attr("pageindex"),e.basewidget.fire_event(e.name,"page_changed_event"))})}}class ControlQueryCombo extends ControlBase{init_control(){for(var e="<div id='"+this.place_id()+"' class='field control ControlQueryCombo' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label>",t=(e+="<select class='ui search dropdown' id='"+this.control_id()+"' ></select></div>",this.jquery_place().replaceWith(e),document.getElementById(this.control_id())),i=0;i<this.properties.items.length;++i){var s=document.createElement("option");s.text=this.properties.items[i].label,s.value=this.properties.items[i].value,t.add(s)}var r=this;this.jquery().dropdown({onChange:function(){r.basewidget.fire_event(r.name,"update_control_event")}}),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}set_value(e){this.jquery().dropdown("set value",e)}get_value(){var e=this.jquery().dropdown("get value");return null==e||0==e.length?null:e}deserialize(e){this.properties=$.extend(this.properties,e),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlQueryList extends ControlBase{build_filters_html(e){for(var t="",i=0;i<e.length;i+=4){t+="<div class='fields four'>";for(var s=0;s<4&&!(i+s>=e.length);s++){var r=e[i+s];switch(r.field_type){case"combo":for(var t=(t=(t+="<div class='field'>")+("<label for='"+this.control_id()+"-filter-"+r.column+"'>"+r.label+"</label>"))+("<select class='ui search dropdown queryset-filter' column='"+r.column+"' id='"+this.control_id()+"-filter-"+r.column+"' >")+"<option value='000000000000'>---</label>",o=r.items,a=0;a<o.length;a++)t+="<option filter='"+o[a][0]+"' value='"+o[a][0]+"'>"+o[a][1]+"</label>";t=t+"</select>"+"</div>";break;case"date-range":t=(t=(t+=`<div class='field date-filter' id='${this.control_id()}-filter-${r.column}' >`)+`<label>${r.label}</label>`)+`
                            <div class="ui basic button choose"><i class="icon calendar"></i>Choose range <span></span></div>
                            <div class='circular ui button icon basic mini clear' col='${r.column}' style='display:none' ><i class="remove icon"></i></div>
                            <div class="ui flowing popup bottom left transition hidden">
                              <div class="ui three column center aligned grid">
                                <div class="column">
                                    <div class="ui icon input" style='width:150px;' >
                                        <input type="text" name="begin" class="begin" placeholder="Start date">
                                        <i class="calendar icon"></i>
                                    </div>
                                </div>
                                <div class="column">
                                    <div class="ui icon input" style='width:150px;' >
                                        <input type="text" name="end" class="end" placeholder="End date">
                                        <i class="calendar icon"></i>
                                    </div>
                                </div>
                                <div class="column" style='width:140px;' >
                                  <div class='ui button blue apply' col='${r.column}' ><i class="filter icon"></i>Apply</div>
                                </div>
                              </div>
                            </div>
                        `+"</div>"}}t+="</div>"}return t}init_date_filters_events(e){for(var o=this,t=0;t<e.length;t++){var i=e[t];"date-range"==i.field_type&&($(`#${this.control_id()}-filter-${i.column} .button.choose`).popup({on:"click",popup:`#${this.control_id()}-filter-${i.column} .popup`}),$(`#${this.control_id()}-filter-${i.column} input`).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"1900:3000"}),$(`#${this.control_id()}-filter-${i.column} .button.apply`).click(function(){var e=$(this).attr("col"),t=$(`#${o.control_id()}-filter-${e} .button.choose`),i=(t.popup("hide"),$(`#${o.control_id()}-filter-${e} .begin`).val()),s=$(`#${o.control_id()}-filter-${e} .end`).val(),r="";i||s?(r=r+(i?`[${i};`:"[;")+(s?s+"]":"]"),$(`#${o.control_id()}-filter-${e} .button.clear`).show()):$(`#${o.control_id()}-filter-${e} .button.clear`).hide(),t.children("span").html(r),o.collect_filters_values(),o.update_server_flag=!0,o.basewidget.fire_event(o.name,"filter_changed_event")}),$(`#${this.control_id()}-filter-${i.column} .button.clear`).click(function(){var e=$(this).attr("col");$(`#${o.control_id()}-filter-${e} .begin`).val(""),$(`#${o.control_id()}-filter-${e} .end`).val(""),$(`#${o.control_id()}-filter-${e} .button.choose span`).html(""),$(this).hide(),o.collect_filters_values(),o.update_server_flag=!0,o.basewidget.fire_event(o.name,"filter_changed_event")}))}}pad(e,t){for(var i=String(e);i.length<(t||2);)i="0"+i;return i}formatdate(e){return e.getFullYear()+"-"+this.pad(e.getMonth()+1,2)+"-"+this.pad(e.getDate(),2)}collect_filters_values(){var e=this.properties.filters_list;this.properties.filter_by=[];for(var t=0;t<e.length;t++){switch((h=e[t]).field_type){case"combo":var i=$(`#${this.control_id()}-filter-`+h.column).dropdown("get value");break;case"date-range":var s=$(`#${this.control_id()}-filter-${h.column} .begin`).val(),r=$(`#${this.control_id()}-filter-${h.column} .end`).val();s&&r?i=h.column+`__range=${s},`+r:(i=s?h.column+"__gte="+s:"",i+=s&&r?"&":"",r?(r=new Date(r)).setDate(r.getDate()+1):r=void 0,i+=r?h.column+"__lte="+this.formatdate(r):"")}if(""!=i&&"000000000000"!=i)for(var o=i.split("&"),a=0;a<o.length;a++){var l=o[a].split("=",2),n=l[0],i=l[1],h=(n.endsWith("__range")&&(i=i.split(",",2)),{[n]:i="false"==(i="null"==(i="true"==i?!0:i)?null:i)?!1:i});this.properties.filter_by.push(h)}}}init_control(){this.update_server_flag=!1;var e="<div id='"+this.place_id()+"' class='field control ControlQueryList'>",t=(this.properties.label_visible&&(e+=`<label for='${this.control_id()}'>${this.properties.label}</label>`),this.properties.filters_list),i=(null!=this.properties.search_field_key&&(e=(e+="<div class='field'>")+"<input placeholder='Search by' type='text' name='search_key' id='"+this.control_id()+"-search' /></div>"),t&&0<t.length&&(e+=this.build_filters_html(t)),e+="<div style='overflow-x: auto;' ><table class='ui selectable celled striped table ControlQueryList "+this.properties.css+" sortable' id='"+this.control_id()+"' >",this.properties.columns_align),s=this.properties.columns_size,r=this.properties.horizontal_headers;if(r&&0<r.length){for(var e=e+"<thead>"+"<tr>",o=0;o<r.length;o++)e+=`<th style='${s?"width:"+s[o]:""}; ${i?"text-align:"+i[o]:""}' column='${r[o].column}' >${r[o].label}</th>`;e=e+"</tr>"+"</thead>"}e+="<tbody></tbody></table></div></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value);var a=this,a=(t&&0<t.length&&this.init_date_filters_events(t),null!=this.properties.search_field_key&&$("#"+this.control_id()+"-search").keypress(function(e){if("13"==(e.keyCode||e.which))return a.update_server_flag=!0,a.properties.search_field_key=$(this).val(),a.basewidget.fire_event(a.name,"filter_changed_event"),!1}),$("#"+this.place_id()+" .queryset-filter").dropdown({onChange:function(e,t,i){a.collect_filters_values(),a.update_server_flag=!0,a.basewidget.fire_event(a.name,"filter_changed_event")},fullTextSearch:"exact",match:"text"}),this);$("#"+this.control_id()+" thead th").click(function(){$("#"+a.control_id()+" tbody td").removeClass("active"),$("#"+a.control_id()+" tbody tr").removeClass("active"),a.properties.selected_index=-1,$(this).hasClass("ascending")?($(this).removeClass("ascending"),$(this).addClass("descending")):$(this).hasClass("descending")?($(this).removeClass("sorted"),$(this).removeClass("descending")):($(this).addClass("sorted"),$(this).addClass("ascending")),a.properties.sort_by=[],$("#"+a.control_id()+" thead th").each(function(e){var t;($(this).hasClass("ascending")||$(this).hasClass("descending"))&&(t={column:$(this).attr("column"),desc:$(this).hasClass("descending")},a.properties.sort_by.push(t))}),a.update_server_flag=!0,a.basewidget.fire_event(a.name,"sort_changed_event")}),this.properties.required&&this.set_required()}get_value(){}set_value(e){this.properties.horizontal_headers;for(var t=e,i=(null==this.properties.search_field_key?$("#"+this.place_id()+"-search").val(""):$("#"+this.place_id()+"-search").val(this.properties.search_field_key),""),s=this.properties.columns_align,r=0;r<t.length;r++){var o=this.properties.selected_row_id==t[r][0];i+="<tr row-id='"+t[r][0]+"' >";for(var a=1;a<t[r].length;a++)i+=`<td style='${s?"text-align:"+s[a-1]:""}' class='${o?"active":""}' >${t[r][a]||""}</td>`;i+="</tr>"}$("#"+this.control_id()+" tbody").html(i),$("#"+this.control_id()+" tfoot").remove();var e=this.properties.horizontal_headers,l="",n=this.properties.pages.pages_list;if(1<n.length){l=(l=(l+="<tfoot>")+"<tr>"+('<th colspan="'+(e?e.length:1)+'">'))+('<a class="ui pointing basic label">'+this.properties.values_total+" results</a> "),this.properties.export_csv&&(l+='<a class="ui button mini basic export-csv-btn "> <i class="ui icon cloud download"></i> CSV</a> '),l+='<div class="ui right floated pagination menu tiny">',0<n[0]&&(l+='<a class="icon item" pageindex="'+n[0]+'" ><i class="left chevron icon"></i></a>');for(r=1;r<n.length-1;r++)l+='<a pageindex="'+n[r]+'" class="item '+(n[r]==this.properties.pages.current_page?"active":"")+'">'+n[r]+"</a>";0<n[n.length-1]&&(l+='<a pageindex="'+n[n.length-1]+'" class="icon item"><i class="right chevron icon"></i></a>'),l=(l=l+"</div>"+"</th>")+"</tr>"+"</tfoot>",$("#"+this.control_id()+" tbody ").after(l)}this.set_click_events()}set_label(e){}set_click_events(){var t=this;$("#"+this.control_id()+" tbody td").click(function(){var e;$(this).hasClass("active")||(e=$(this).parent().attr("row-id"),t.update_server_flag=e!=t.properties.selected_row_id,t.properties.selected_row_id=e,t.basewidget.fire_event(t.name,"item_selection_changed_client_event"))}),$("#"+this.control_id()+" .pagination .item").click(function(){$(this).hasClass("active")||(t.update_server_flag=!0,t.properties.pages.current_page=$(this).attr("pageindex"),t.basewidget.fire_event(t.name,"page_changed_event"))}),$("#"+this.control_id()+" .export-csv-btn").click(function(){t.basewidget.fire_event(t.name,"export_csv_event")})}update_server(){return this.update_server_flag}serialize(){var e=super.serialize();return this.update_server_flag=!1,e}}class ControlSearch extends ControlBase{get_value(){return this.properties.value}init_control(){var e=`<div class="ui field '${this.properties.css}' control ControlSearch" id="${this.place_id()}"  >
            <div ${this.control_id()} class="ui labeled icon top right pointing dropdown button">
              <i class="filter icon"></i>
              <span class="text">Filter Posts</span>
              <div class="menu">
                <div class="ui search icon input">
                  <i class="search icon"></i>
                  <input type="text" name="search" placeholder="Search issues...">
                </div>
                <div class="divider"></div>
                <div class="header">
                  <i class="tags icon"></i>
                  Filter by tag
                </div>
                <div class="item">
                  <div class="ui red empty circular label"></div>
                  Important
                </div>
                <div class="item">
                  <div class="ui blue empty circular label"></div>
                  Announcement
                </div>
                <div class="item">
                  <div class="ui black empty circular label"></div>
                  Discussion
                </div>
                <div class="divider"></div>
                <div class="header">
                  <i class="calendar icon"></i>
                  Filter by date
                </div>
                <div class="item">
                  <i class="olive circle icon"></i>
                  This Week
                </div>
                <div class="item">
                  <i class="violet circle icon"></i>
                  This Month
                </div>
                <div class="item">
                  <i class="orange circle icon"></i>
                  This Year
                </div>
              </div>
            </div>
        </div>`;this.jquery_place().replaceWith(e),this.jquery().dropdown({apiSettings:{url:this.properties.items_url},saveRemoteData:!1,placeholder:!1,forceSelection:!1}),this.properties.required&&this.set_required()}set_value(e){this.init_control()}}class ControlSimpleLabel extends ControlBase{get_value(){return this.properties.value}init_control(){var e='<div class="ui field '+this.properties.css+' control ControlSimpleLabel" id="'+this.place_id()+'"  >';this.properties.label&&(e=(e+='<div class="header">')+this.properties.label+"</div>"),e+='<p id="'+this.control_id()+'" >',null==this.properties.value&&null==this.properties.value||(e+=this.properties.value),e+="</p></div>",this.jquery_place().replaceWith(e),this.properties.required&&this.set_required()}set_value(e){this.init_control()}}class ControlSlider extends ControlBase{get_value(){return this.jquery().val()}set_value(e){this.jquery().val(e),$("#value"+this.name).html(e),this.jquery().attr("max",this.properties.max),this.jquery().attr("min",this.properties.min)}init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlSlider' title='"+this.properties.help+"' >",t=(e=(e=(e+="<label for='"+this.control_id()+"'>"+this.properties.label)+(" <div id='value"+this.control_id()+"' class='ui basic label'>"+this.properties.value+"</div>")+"</label>")+("<input style='width:100%;' type='range' name='"+this.name+"' value='"+this.properties.value+"' id='"+this.control_id()+"' min='"+this.properties.min+"' max='"+this.properties.max+"'>")+"</div>",this.jquery_place().replaceWith(e),this);this.jquery().change(function(){$("#value"+t.control_id()).html($(this).val()),t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.required&&this.set_required()}deserialize(e){this.properties=$.extend(this.properties,e),this.set_value(this.properties.value)}serialize(){return this.properties.value=this.get_value(),this.properties}}class ControlSpacer extends ControlBase{init_control(){this.jquery_place().replaceWith("<div id='"+this.place_id()+"' class='field control ControlText' ></div>")}}class ControlTemplate extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlTemplate' ><div id='"+this.control_id()+"' ></div></div>";this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this.properties.required&&this.set_required()}set_value(e){e=Base64.decode(e);e?(this.jquery().html(e),this.set_actions()):this.jquery().html("")}set_actions(){this.properties.action_param=void 0;const s=this;this.jquery().find("[action]").click(function(){var e=$(this).attr("action"),t=$(this).attr("action-param");s.properties.action_param=t,s.basewidget.fire_event("self",e)}),this.jquery().find("[submit-action]").click(function(){var e=$(this).attr("submit-action");const i={};s.jquery().find("[submit-action-name]").each(function(){var e=$(this).attr("submit-action-name"),t=$(this).is(":checked");i[e]=t}),s.properties.submit_action_data=i,s.basewidget.fire_event("self",e)})}update_server(){return null!=this.properties.action_param||null!=this.properties.submit_action_data}}class ControlText extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlText' >",t=(this.properties.label_visible&&(e+="<label for='"+this.control_id()+"'>"+this.properties.label+"</label>"),e=e+("<input type='text' name='"+this.name+"' id='"+this.control_id()+"' placeholder='"+this.properties.placeholder+"' value='' />")+"</div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this);this.jquery().change(function(){t.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}}class ControlTextArea extends BaseControlStreaming{xmlhttp=void 0;constructor(e,t){super(e,t)}init_control(){var e=`<div id='${this.place_id()}' class='field control ControlTextArea' >
		    <label for='${this.control_id()}'>${this.properties.label}</label>
		    <textarea placeholder='${this.properties.placeholder}' type='text'
		    rows='${this.properties.rows}' cols='${this.properties.cols}'
		    name='${this.name}' id='${this.control_id()}' ></textarea>
		</div>`,t=(this.jquery_place().replaceWith(e),this.set_value(this.properties.value),this);this.jquery().change(function(){t.basewidget.fire_event(this.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}enable(){this.jquery().removeAttr("readonly"),this.jquery().removeClass("disabled")}disable(){this.jquery().attr("readonly","readonly"),this.jquery().addClass("disabled")}stream_update(e){super.stream_update(e),this.jquery()[0].scrollTop=this.jquery()[0].scrollHeight}}class ControlThumbnailSelection extends ControlBase{init_control(){var e=`
			<div id='${this.place_id()}' class='field control ControlText' >
				<label for='${this.control_id()}'>${this.properties.label}</label>
				<div class="ui grid"  id='${this.control_id()}' ></div>
			</div>
		`;this.jquery_place().replaceWith(e),this.set_value(this.properties.value)}set_value(e){if(this.properties.value){let t="";var i=this.properties.labels;for(let e=0;e<this.properties.value.length;e++){var s=this.properties.value[e];t+=`
				<div class="four wide column">
					<div class="ui card">
						<div class="ui slide masked reveal image">
							<img src="/media/thumbnails/${s.thumbnails[0]}" class="visible content">
							<img src="/media/thumbnails/${s.thumbnails[1]}" class="hidden content">
						</div>
						<div class="content">
							<div class="description">
								<div class="grouped fields">
			`;for(let e=0;e<i.length;e++)t+=`
					<div class="field">
						<div class="ui radio checkbox">
							<input type="radio" name="group_${s.pk}" pk="${s.pk}" label="${i[e]}" checked="${new String(s.selected_label).valueOf()===new String(i[e]).valueOf()?"checked":""}" tabindex="0" class="hidden">
							<label>${i[e]}</label>
						</div>
					</div>
				`;t+=`
								</div>
							</div>
						</div>
					</div>
				</div>
			`}this.jquery().html(t),this.properties.value=[];const r=this;this.jquery().find(".ui.radio.checkbox").checkbox({onChange:function(){r.update_control=!0,r.properties.selected_pk=$(this).attr("pk"),r.properties.selected_label=$(this).attr("label"),console.debug($(this).attr("pk"),$(this).attr("label ")),r.basewidget.fire_event(r.name,"update_selection_event")}})}}update_server(){return!!this.update_control&&!(this.update_control=void 0)}}class ControlTime extends ControlBase{getItems(e){for(var t=[],i=!1,s=0;s<=1440;s+=30)!i&&s<e&&(t.push({value:s,text:String(Math.floor(e/60)).padStart(2,"0")+":"+String(Math.floor(e%60)).padStart(2,"0"),name:String(Math.floor(e/60)).padStart(2,"0")+":"+String(Math.floor(e%60)).padStart(2,"0")}),i=!0),t.push({value:s,text:String(Math.floor(s/60)).padStart(2,"0")+":"+String(Math.floor(s%60)).padStart(2,"0"),name:String(Math.floor(s/60)).padStart(2,"0")+":"+String(Math.floor(s%60)).padStart(2,"0")});return t}init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlTime' ><label>"+this.properties.label+"</label>",t=(e=(e=e+("<div class='ui search dropdown selection' id='"+this.control_id()+"' >")+'<i class="dropdown icon"></i>')+('<div class="default text">'+this.properties.placeholder+"</div>")+"</div>",this);this.jquery_place().replaceWith(e),this.jquery().dropdown(),this.jquery().dropdown("setup menu",{values:this.getItems(this.properties.value)}),this.set_value(this.properties.value),this.jquery().dropdown("setting","onChange",function(){t.flag_exec_on_change_event&&t.basewidget.fire_event(t.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}set_value(e){this.flag_exec_on_change_event=!1,this.jquery().dropdown("set exactly",[String(e)]),this.flag_exec_on_change_event=!0}get_value(){var e=this.jquery().dropdown("get value");return"None"==e?null:"true"==e||"false"!=e&&("null"==e?null:e)}deserialize(e){this.properties=$.extend(this.properties,e),this.jquery().dropdown("setup menu",{values:this.getItems(this.properties.value)}),this.set_value(this.properties.value),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error")}}class ControlTimeout extends ControlBase{constructor(e,t){super(e,t),this.timer=void 0}init_control(){var e=(e="<div id='"+this.place_id()+"' class='field control ControlTimeout' ><label>"+this.properties.label+"</label>")+("<div id='"+this.control_id()+"' data-percent='0' class='ui tiny progress'><div class='bar'></div></div>")+"</div>";this.jquery_place().replaceWith(e),this.set_value(this.properties.value),"True"==this.properties.play&&this.update_progress_bar(!0),this.properties.required&&this.set_required()}update_progress_bar(e){var t;e||this.jquery().progress("increment",this.properties.update_interval),parseInt(this.jquery().attr("data-percent"))<100?(t=this).timer=setTimeout(function(){t.update_progress_bar(!1)},t.properties.update_interval):this.basewidget.fire_event(this.name,"trigger_event")}get_value(){return this.properties.value}set_value(e){this.jquery().progress({total:e,value:0})}deserialize(e){e.play="True"==e.play,last_play_value=this.properties.play,$.extend(this.properties,e),0!=this.properties.play&&void 0===e.value||null!=this.timer&&(clearTimeout(this.timer),this.timer=void 0),void 0!==e.value&&(this.set_value(this.properties.value),this.properties.play)&&this.update_progress_bar(!1),0==last_play_value&&this.properties.play&&this.update_progress_bar(!1)}}class ControlTree extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlTree' >";e+="<ul class='tree' id='"+this.control_id()+"' >";for(var t=0;t<this.properties.root.childs.length;t++)e+=this.render_node(this.properties.root.childs[t]);e+="</ul></div>",this.jquery_place().replaceWith(e),this.set_value(this.properties.value);var i=this;$("#"+this.control_id()+" label").click(function(){i.set_value($(this).attr("node-id")),i.basewidget.fire_event(i.name,"update_control_event")}),this.properties.error?this.jquery_place().addClass("error"):this.jquery_place().removeClass("error"),this.properties.required&&this.set_required()}render_node(e){var t="<li><label node-id='"+e.node_id+"' >"+e.name+"</label>";if(0<e.childs.length){t+="<ul>";for(var i=0;i<e.childs.length;i++)t+=this.render_node(e.childs[i]);t+="</ul>"}return t+="</li>"}set_value(e){$("#"+this.control_id()+" label").removeClass("selected"),$("#"+this.control_id()+" label[node-id="+e+"]").addClass("selected")}get_value(){var e=$("#"+this.control_id()+" label.selected");return 0<e.length?e.attr("node-id"):null}set_label(e){}}class ControlVisVis extends ControlBase{init_control(){this.update_it=!1;var e="<div id='"+this.place_id()+"' class='field control ControlVisVis' >",e=(e+="<div id='chart-container-"+this.control_id()+"' title='"+this.properties.help+"'   >")+"<div id='"+this.control_id()+"' ></div></div></div>";this.jquery_place().replaceWith(e);var e=(r=this).properties.legend,t=r.properties.value,t=(0!=t.length&&0!=t[0].length||(t=[[[0,0]]]),$.jqplot(this.control_id(),t,{grid:{borderColor:"transparent",shadow:!1,drawBorder:!1,shadowColor:"transparent",background:"transparent"},title:r.label,seriesDefaults:{showMarker:!1,showLine:!0,lineWidth:1,markerOptions:{size:6}},legend:{show:0<e.length,labels:e,placement:"outside",location:"e"},axes:{},cursor:{style:"pointer",show:!0,zoom:!0,tooltipOffset:10,showTooltip:!0,followMouse:!0,showTooltipDataPosition:!0,showVerticalLine:!0}})),r=(this.chart=t,this);this.jquery().bind("jqplotDataClick",function(e,t,i,s){r.properties.selected_series=t,r.properties.selected_data=s,r.update_it=!0,r.basewidget.fire_event(r.name,"remote_data_selected_event")}),this.properties.required&&this.set_required()}set_value(e){e={data:e,legend:{show:0<this.properties.legend.length,labels:this.properties.legend,showLabels:!0,showSwatch:!0}};this.chart.replot(e)}get_value(){return this.properties.value}update_server(){return this.get_value()!=this.properties.value||this.update_it}deserialize(e){this.properties=$.extend(this.properties,e),this.set_value(this.properties.value)}serialize(){return this.properties.value=this.get_value(),this.properties}}class ControlWorkflow extends ControlBase{init_control(){var e="<div id='"+this.place_id()+"' class='field control ControlWorkflow ui segment' ><label for='"+this.control_id()+"'>"+this.properties.label+"</label><div id='"+this.control_id()+"' ></div></div>",t=(this.jquery_place().replaceWith(e),this);this.jquery().change(function(){t.basewidget.fire_event(t.name,"update_control_event",!1)}),$("#"+this.control_id()).flowchart({data:this.properties.value,multipleLinksOnOutput:!0}),this.properties.operator_selected_evt&&$("#"+this.control_id()).flowchart({onOperatorSelect:function(e){return $("#"+t.control_id()).flowchart("unselectLink"),t.properties.selected_operator=e,t.properties.stop_operator_select_evt||(t.properties.no_selected_operator_update=1,t.properties.no_selected_link_update=1,t.properties.selected_operator=e,t.properties.selected_link=void 0,t.basewidget.fire_event(t.name,"operator_selected_evt",!1),t.properties.no_selected_operator_update=void 0),!0}}),this.properties.operator_unselected_evt&&$("#"+this.control_id()).flowchart({onOperatorUnselect:function(){return t.properties.selected_operator=void 0,t.properties.stop_operator_unselect_evt||(t.properties.no_selected_operator_update=1,t.properties.no_selected_link_update=1,t.basewidget.fire_event(t.name,"operator_unselected_evt",!1),t.properties.no_selected_operator_update=void 0),!0}}),this.properties.link_selected_evt&&$("#"+this.control_id()).flowchart({onLinkSelect:function(e){return $("#"+t.control_id()).flowchart("unselectOperator"),t.properties.selected_link=e,t.properties.stop_link_select_evt||(t.properties.no_selected_operator_update=1,t.properties.no_selected_link_update=1,t.properties.selected_link=e,t.properties.selected_operator=void 0,t.basewidget.fire_event(t.name,"link_selected_evt",!1),t.properties.no_selected_link_update=void 0),!0}}),this.properties.link_unselected_evt&&$("#"+this.control_id()).flowchart({onLinkUnselect:function(){return t.properties.selected_link=void 0,t.properties.stop_link_unselect_evt||(t.properties.no_selected_operator_update=1,t.properties.no_selected_link_update=1,t.basewidget.fire_event(t.name,"link_unselected_evt",!1),t.properties.no_selected_link_update=void 0),!0}}),this.properties.required&&this.set_required()}set_value(e){$("#"+this.control_id()).flowchart("setData",e)}get_value(){return $("#"+this.control_id()).flowchart("getData")}serialize(){var e;return this.properties.value=this.get_value(),this.properties.no_selected_operator_update||(e=$("#"+this.control_id()).flowchart("getSelectedOperatorId"))&&(this.properties.selected_operator=e),this.properties.no_selected_link_update||(e=$("#"+this.control_id()).flowchart("getSelectedLinkId"))&&(this.properties.selected_link=e),this.properties}deserialize(e){$.extend(this.properties,e),this.set_value(this.properties.value),this.properties.selected_operator&&(this.properties.stop_operator_select_evt=1,$("#"+this.control_id()).flowchart("selectOperator",this.properties.selected_operator),this.properties.stop_operator_select_evt=void 0),0<=this.properties.selected_link&&(this.properties.stop_link_select_evt=1,this.properties.stop_link_unselect_evt=1,$("#"+this.control_id()).flowchart("selectLink",this.properties.selected_link),this.properties.stop_link_select_evt=void 0,this.properties.stop_link_unselect_evt=void 0),e.deleteSelected&&(this.properties.stop_operator_unselect_evt=1,this.properties.stop_link_unselect_evt=1,$("#"+this.control_id()).flowchart("deleteSelected"),this.properties.stop_operator_unselect_evt=void 0,this.properties.stop_link_unselect_evt=void 0)}}class MultiInheritance{static inherit(...e){class t{get base(){return e}constructor(...e){var t,i=0;for(t of this.base){var s=new t(e[i++]);MultiInheritance.copy(this,s)}}}for(var i of e)MultiInheritance.copy(t,i),MultiInheritance.copy(t.prototype,i.prototype);return t}static copy(e,t){for(var i of Reflect.ownKeys(t)){var s;"constructor"!==i&&"prototype"!==i&&"name"!==i&&(s=Object.getOwnPropertyDescriptor(t,i),Object.defineProperty(e,i,s))}}}function error_msg(e){alert(e)}function run_application(e,t,i){var s={};i&&(s.method=i),t&&(s.constructor=t),s=JSON.stringify(s),$.ajaxSetup({async:!1,cache:!0}),$.ajax({method:"post",cache:!1,dataType:"json",data:s,url:PYFORMS_SERVER_URL+"/pyforms/app/register/"+e+"/?nocache="+$.now(),contentType:"application/json; charset=utf-8",success:function(e){if("error"==e.result)error_msg(e.msg);else for(var t=0;t<e.length;t++)pyforms.open_application(e[t])}}).fail(function(e){error_msg(e.status+" "+e.statusText+": "+e.responseText)}).always(function(){$.ajaxSetup({async:!0,cache:!0})})}function pyforms_checkhash(){var e=window.location.hash;if(0!=e.length&&"#/"==e.slice(0,2)){var t=e.split("/"),i=t[1],s=2<t.length&&"?"!=t[2][0]?t[2]:void 0;if(i){var r={};if(s){r.method=s,r.params={};for(var o=3;o<t.length;o+=2)r.params[t[o]]=t[o+1]}var a={},s=e.split("?"),l="";(l=2<=s.length?s[1]:l).replace(/([^=&]+)=([^&]*)/g,function(e,t,i){a[decodeURIComponent(t)]=decodeURIComponent(i)}),run_application(i,a,r),"&"!=e.charAt(e.length-1)&&(window.location.hash=e+(1<s.length?"":"?")+"&")}}}var pyforms_checkhash_flag=!0;function pyforms_checkhash_wrapper(){pyforms_checkhash_flag&&(pyforms_checkhash_flag=!1,pyforms_checkhash(),setTimeout("pyforms_checkhash_flag=true;",500))}$(window).bind("hashchange",pyforms_checkhash_wrapper);var PYFORMS_SERVER_URL="",PYFORMS_CHECKER_LOOP_INTERVAL=700,loading,not_loading,pyforms;!function(i){i.getStylesheet=function(e){var t=i.Deferred(),e=i("<link/>",{rel:"stylesheet",type:"text/css",href:e}).appendTo("head");return t.resolve(e),t.promise()}}(jQuery),$.ajaxSetup({cache:!0}),"function"!=typeof loading&&(loading=function(){}),"function"!=typeof not_loading&&(not_loading=function(){});class PyformsManager{constructor(){this.loop_checks=[],this.loop=void 0,this.layout_places=[],this.applications=[],this.active_app=null,setInterval(this.garbage_collector,5e3),$(document).keydown(e=>{this.active_app&&"INPUT"!==e.target.nodeName&&this.active_app.key_pressed(e)})}add_app(e){for(var t=0;t<this.applications.length;t++)if(null!=this.applications[t]&&this.applications[t].widget_id==e.widget_id){this.applications[t].close_sub_apps(),delete this.applications[t],this.applications.slice(t,1);break}this.applications.push(e)}remove_app(e,t){var i=null;if(null==t)for(var s=0;s<this.applications.length;s++)null!=this.applications[s]&&this.applications[s].widget_id==e&&(t=s);null!=(i=this.applications[t])&&$.ajax({method:"get",cache:!1,dataType:"json",url:PYFORMS_SERVER_URL+"/pyforms/app/remove/"+i.widget_id+"/?nocache="+$.now(),contentType:"application/json; charset=utf-8"}).always(function(){i.close(),delete pyforms.applications[t],pyforms.applications.slice(t,1)})}find_app(e){for(var t=0;t<this.applications.length;t++)if(null!=this.applications[t]&&this.applications[t].widget_id==e)return this.applications[t]}find_control(e){var e=this.split_id(e),t=e[0],e=e[1];return this.find_app(t).find_control(e)}split_id(e){var t=e.lastIndexOf("-");return[e.substring(0,t),e.substring(t+1)]}query_server(e,t,i){var s,r;void 0===t&&(t={}),void 0===i&&(i=!0),void 0!==e.parent_id?(s=e.parent_widget(),this.query_server(s,t)):(i&&e.loading(),t=e.serialize_data(t),s=JSON.stringify(t),r=this,$.ajaxSetup({async:!0,cache:!0}),$.ajax({method:"post",cache:!1,dataType:"json",url:PYFORMS_SERVER_URL+"/pyforms/app/update/"+e.widget_id+"/?nocache="+$.now(),data:s,contentType:"application/json; charset=utf-8",success:function(e){if("error"==e.result)error_msg(e.msg);else for(var t=0;t<e.length;t++)r.open_application(e[t])}}).fail(function(e){error_msg(e.status+" "+e.statusText+": "+e.responseText)}).always(function(){i&&e.not_loading(),$.ajaxSetup({async:!0,cache:!0})}),0<e.events_queue.length&&this.query_server(e,e.events_queue.pop(0)))}register_checkloop(e){this.loop_checks.push(e),void 0===this.loop&&(this.loop=setInterval(pyforms.checker_loop,PYFORMS_CHECKER_LOOP_INTERVAL))}checker_loop(){for(var e=pyforms.loop_checks.length-1;0<=e;e--)pyforms.loop_checks[e]()||pyforms.loop_checks.splice(e,1);0==pyforms.loop_checks.length&&(clearInterval(pyforms.loop),pyforms.loop=void 0)}register_layout_place(e,t,i,s){for(var r=!0,o=0;o<this.layout_places.length;o++)if(this.layout_places[o].place_id==e){this.layout_places[o].open_handler=t,this.layout_places[o].activate_handler=i,this.layout_places[o].close_handler=s,r=!1;break}r&&this.layout_places.push({place:e,open_handler:t,activate_handler:i,close_handler:s})}open_application(e){var t=pyforms.find_app(e.uid),i=e.layout_position,s=e.uid;if(null!=t){if(t.deserialize(e),!e.close_widget)for(var r=0;r<this.layout_places.length;r++)if(this.layout_places[r].place==i&&this.layout_places[r].activate_handler){this.layout_places[r].activate_handler(s);break}not_loading()}else{for(var s=e.uid,o=PYFORMS_SERVER_URL+"/pyforms/app/open/"+s+"/",a=e.title,l=!1,r=0;r<this.layout_places.length;r++)if(this.layout_places[r].place==i){this.layout_places[r].open_handler(s,a,o),l=!0;break}l||($.ajaxSetup({async:!1,cache:!0}),$.ajax({method:"get",cache:!1,dataType:"json",url:o,contentType:"application/json; charset=utf-8",success:function(e){var t;"error"==e.result?error_msg(e.msg):(t=(t=(t="")+"<div class=\"app-segment ui container\" ><form onsubmit='return false;' class='ui form "+e.css+"' id='app-"+e.app_id+"' >")+e.code+"</form></div>",$("#"+i).html(t))}}).fail(function(e){error_msg(e.status+" "+e.statusText+": "+e.responseText)}).always(function(){$.ajaxSetup({async:!0,cache:!0}),pyforms.garbage_collector()}))}}garbage_collector(){for(var e=pyforms.applications.length-1;0<=e;e--)null!=pyforms.applications[e]&&0==pyforms.applications[e].jquery().length&&pyforms.remove_app(null,e)}close_layout_place(e){var t=pyforms.find_app(e.uid),i=e.layout_position,s=e.uid;if(null!=t)for(var r=0;r<this.layout_places.length;r++)if(this.layout_places[r].place==i&&this.layout_places[r].close_handler){this.layout_places[r].close_handler(s);break}}}null==pyforms&&(pyforms=new PyformsManager);